<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paste Image</title>
    <style>
        body { color: silver;margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; font-family: sans-serif; background-color: rgb(36, 34, 41)}
        canvas { border: 1px solid #ccc; width: 100vw; height: 100vh; display: none; }
        p { margin-bottom: 10px; }
    </style>
</head>
<body>
    <p>Click anywhere on the page to attempt to paste an image from clipboard.</p>
    <canvas id="pasteCanvas"></canvas>
    <script>
        const canvas = document.getElementById('pasteCanvas');
        const ctx = canvas.getContext('2d');

        document.body.onclick = async () => {
            if (!navigator.clipboard || !navigator.clipboard.read) {
                console.warn("Clipboard API not fully supported or permission issue.");
                alert("Cannot access clipboard. Try Ctrl+V or check browser permissions/support.");
                return;
            }
            try {
                const clipboardItems = await navigator.clipboard.read();
                for (const item of clipboardItems) {
                    const imageType = item.types.find(type => type.startsWith('image/'));
                    if (imageType) {
                        const blob = await item.getType(imageType);
                        const imageBitmap = await createImageBitmap(blob);
                        canvas.width = imageBitmap.width;
                        canvas.height = imageBitmap.height;
                        ctx.drawImage(imageBitmap, 0, 0);
                        canvas.style.display = 'block';
                        document.querySelector('p').style.display = 'none'; // Hide instruction
                        return; // Found and pasted an image
                    }
                }
                alert("No image found on clipboard, or format not supported by this method.");
            } catch (err) {
                console.error('Error pasting image:', err);
                alert(`Error pasting: ${err.name}. Check console and permissions.`);
            }
        };

        // Fallback for standard paste event (Ctrl+V, Cmd+V, context menu "Paste")
        document.addEventListener('paste', async (event) => {
            if (!event.clipboardData || !event.clipboardData.items) return;
            for (const item of event.clipboardData.items) {
                if (item.type.startsWith('image/')) {
                    event.preventDefault();
                    const blob = item.getAsFile();
                    if (blob) {
                        try {
                            const imageBitmap = await createImageBitmap(blob);
                            canvas.width = imageBitmap.width;
                            canvas.height = imageBitmap.height;
                            ctx.drawImage(imageBitmap, 0, 0);
                            canvas.style.display = 'block';
                            document.querySelector('p').style.display = 'none'; // Hide instruction
                        } catch (err) {
                            console.error('Error processing pasted image blob:', err);
                            alert('Error processing pasted image.');
                        }
                        return;
                    }
                }
            }
        });
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]\\^$.|?*+()]/g, '\\$&');
            var regex = new RegExp('([?&])' + name + '=([^&#]*)');
            var results = regex.exec(url);
            return results && results[2];
          }
        
          window.onload = function() {
            const imageData = getParameterByName('imageData');
            const mimeType = getParameterByName('mimeType');
        
            if (imageData && mimeType) {
              const img = new Image();
              img.onload = () => {
                  canvas.width = img.width;
                  canvas.height = img.height;
                  ctx.drawImage(img, 0, 0);
                  canvas.style.display = 'block';
                  document.querySelector('p').style.display = 'none'; // Hide instruction
              };
              img.src = `data:${mimeType};base64,${imageData}`;
            } 
          };
    </script>
</body>
</html>
