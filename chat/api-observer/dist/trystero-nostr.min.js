function t(t){if(!Number.isSafeInteger(t)||t<0)throw Error("positive integer expected, got "+t)}function e(t,...e){if(!((r=t)instanceof Uint8Array||ArrayBuffer.isView(r)&&"Uint8Array"===r.constructor.name))throw Error("Uint8Array expected");var r;if(e.length>0&&!e.includes(t.length))throw Error("Uint8Array expected of length "+e+", got length="+t.length)}function r(t,e=!0){if(t.destroyed)throw Error("Hash instance has been destroyed");if(e&&t.finished)throw Error("Hash#digest() has already been called")}const n="object"==typeof globalThis&&"crypto"in globalThis?globalThis.crypto:void 0;function i(t){return new DataView(t.buffer,t.byteOffset,t.byteLength)}function s(t,e){return t<<32-e|t>>>e}function o(t){return"string"==typeof t&&(t=function(t){if("string"!=typeof t)throw Error("utf8ToBytes expected string, got "+typeof t);return new Uint8Array((new TextEncoder).encode(t))}(t)),e(t),t}class a{clone(){return this._cloneInto()}}function h(t){const e=e=>t().update(o(e)).digest(),r=t();return e.outputLen=r.outputLen,e.blockLen=r.blockLen,e.create=()=>t(),e}function l(t=32){if(n&&"function"==typeof n.getRandomValues)return n.getRandomValues(new Uint8Array(t));if(n&&"function"==typeof n.randomBytes)return n.randomBytes(t);throw Error("crypto.getRandomValues must be defined")}function c(t,e,r){return t&e^t&r^e&r}class d extends a{constructor(t,e,r,n){super(),this.blockLen=t,this.outputLen=e,this.padOffset=r,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(t),this.view=i(this.buffer)}update(t){r(this);const{view:e,buffer:n,blockLen:s}=this,a=(t=o(t)).length;for(let r=0;r<a;){const o=Math.min(s-this.pos,a-r);if(o!==s)n.set(t.subarray(r,r+o),this.pos),this.pos+=o,r+=o,this.pos===s&&(this.process(e,0),this.pos=0);else{const e=i(t);for(;s<=a-r;r+=s)this.process(e,r)}}return this.length+=t.length,this.roundClean(),this}digestInto(t){r(this),function(t,r){e(t);const n=r.outputLen;if(t.length<n)throw Error("digestInto() expects output buffer of length at least "+n)}(t,this),this.finished=!0;const{buffer:n,view:s,blockLen:o,isLE:a}=this;let{pos:h}=this;n[h++]=128,this.buffer.subarray(h).fill(0),this.padOffset>o-h&&(this.process(s,0),h=0);for(let t=h;t<o;t++)n[t]=0;!function(t,e,r,n){if("function"==typeof t.setBigUint64)return t.setBigUint64(e,r,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(r>>i&s),a=Number(r&s),h=n?4:0,l=n?0:4;t.setUint32(e+h,o,n),t.setUint32(e+l,a,n)}(s,o-8,BigInt(8*this.length),a),this.process(s,0);const l=i(t),c=this.outputLen;if(c%4)throw Error("_sha2: outputLen should be aligned to 32bit");const d=c/4,u=this.get();if(d>u.length)throw Error("_sha2: outputLen bigger than state");for(let t=0;t<d;t++)l.setUint32(4*t,u[t],a)}digest(){const{buffer:t,outputLen:e}=this;this.digestInto(t);const r=t.slice(0,e);return this.destroy(),r}_cloneInto(t){t||(t=new this.constructor),t.set(...this.get());const{blockLen:e,buffer:r,length:n,finished:i,destroyed:s,pos:o}=this;return t.length=n,t.pos=o,t.finished=i,t.destroyed=s,n%e&&t.buffer.set(r),t}}const u=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),f=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),p=new Uint32Array(64);class g extends d{constructor(){super(64,32,8,!1),this.A=0|f[0],this.B=0|f[1],this.C=0|f[2],this.D=0|f[3],this.E=0|f[4],this.F=0|f[5],this.G=0|f[6],this.H=0|f[7]}get(){const{A:t,B:e,C:r,D:n,E:i,F:s,G:o,H:a}=this;return[t,e,r,n,i,s,o,a]}set(t,e,r,n,i,s,o,a){this.A=0|t,this.B=0|e,this.C=0|r,this.D=0|n,this.E=0|i,this.F=0|s,this.G=0|o,this.H=0|a}process(t,e){for(let r=0;r<16;r++,e+=4)p[r]=t.getUint32(e,!1);for(let t=16;t<64;t++){const e=p[t-15],r=p[t-2],n=s(e,7)^s(e,18)^e>>>3,i=s(r,17)^s(r,19)^r>>>10;p[t]=i+p[t-7]+n+p[t-16]|0}let{A:r,B:n,C:i,D:o,E:a,F:h,G:l,H:d}=this;for(let t=0;t<64;t++){const e=d+(s(a,6)^s(a,11)^s(a,25))+((f=a)&h^~f&l)+u[t]+p[t]|0,g=(s(r,2)^s(r,13)^s(r,22))+c(r,n,i)|0;d=l,l=h,h=a,a=o+e|0,o=i,i=n,n=r,r=e+g|0}var f;r=r+this.A|0,n=n+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,h=h+this.F|0,l=l+this.G|0,d=d+this.H|0,this.set(r,n,i,o,a,h,l,d)}roundClean(){p.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const m=h((()=>new g));class y extends a{constructor(e,r){super(),this.finished=!1,this.destroyed=!1,function(e){if("function"!=typeof e||"function"!=typeof e.create)throw Error("Hash should be wrapped by utils.wrapConstructor");t(e.outputLen),t(e.blockLen)}(e);const n=o(r);if(this.iHash=e.create(),"function"!=typeof this.iHash.update)throw Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let t=0;t<s.length;t++)s[t]^=54;this.iHash.update(s),this.oHash=e.create();for(let t=0;t<s.length;t++)s[t]^=106;this.oHash.update(s),s.fill(0)}update(t){return r(this),this.iHash.update(t),this}digestInto(t){r(this),e(t,this.outputLen),this.finished=!0,this.iHash.digestInto(t),this.oHash.update(t),this.oHash.digestInto(t),this.destroy()}digest(){const t=new Uint8Array(this.oHash.outputLen);return this.digestInto(t),t}_cloneInto(t){t||(t=Object.create(Object.getPrototypeOf(this),{}));const{oHash:e,iHash:r,finished:n,destroyed:i,blockLen:s,outputLen:o}=this;return t.finished=n,t.destroyed=i,t.blockLen=s,t.outputLen=o,t.oHash=e._cloneInto(t.oHash),t.iHash=r._cloneInto(t.iHash),t}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const _=(t,e,r)=>new y(t,e).update(r).digest();_.create=(t,e)=>new y(t,e);const b=BigInt(0),w=BigInt(1),S=BigInt(2);function v(t){return t instanceof Uint8Array||ArrayBuffer.isView(t)&&"Uint8Array"===t.constructor.name}function E(t){if(!v(t))throw Error("Uint8Array expected")}function x(t,e){if("boolean"!=typeof e)throw Error(t+" boolean expected, got "+e)}const C=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function T(t){E(t);let e="";for(let r=0;r<t.length;r++)e+=C[t[r]];return e}function A(t){const e=t.toString(16);return 1&e.length?"0"+e:e}function k(t){if("string"!=typeof t)throw Error("hex string expected, got "+typeof t);return""===t?b:BigInt("0x"+t)}const R=48,N=57,B=65,I=70,O=97,L=102;function P(t){return t>=R&&t<=N?t-R:t>=B&&t<=I?t-(B-10):t>=O&&t<=L?t-(O-10):void 0}function F(t){if("string"!=typeof t)throw Error("hex string expected, got "+typeof t);const e=t.length,r=e/2;if(e%2)throw Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(r);for(let e=0,i=0;e<r;e++,i+=2){const r=P(t.charCodeAt(i)),s=P(t.charCodeAt(i+1));if(void 0===r||void 0===s){const e=t[i]+t[i+1];throw Error('hex string expected, got non-hex character "'+e+'" at index '+i)}n[e]=16*r+s}return n}function D(t){return k(T(t))}function q(t){return E(t),k(T(Uint8Array.from(t).reverse()))}function U(t,e){return F(t.toString(16).padStart(2*e,"0"))}function M(t,e){return U(t,e).reverse()}function H(t,e,r){let n;if("string"==typeof e)try{n=F(e)}catch(e){throw Error(t+" must be hex string or Uint8Array, cause: "+e)}else{if(!v(e))throw Error(t+" must be hex string or Uint8Array");n=Uint8Array.from(e)}const i=n.length;if("number"==typeof r&&i!==r)throw Error(t+" of length "+r+" expected, got "+i);return n}function j(...t){let e=0;for(let r=0;r<t.length;r++){const n=t[r];E(n),e+=n.length}const r=new Uint8Array(e);for(let e=0,n=0;e<t.length;e++){const i=t[e];r.set(i,n),n+=i.length}return r}const z=t=>"bigint"==typeof t&&b<=t;function W(t,e,r){return z(t)&&z(e)&&z(r)&&e<=t&&t<r}function V(t,e,r,n){if(!W(e,r,n))throw Error("expected valid "+t+": "+r+" <= n < "+n+", got "+e)}function K(t){let e;for(e=0;t>b;t>>=w,e+=1);return e}const Z=t=>(S<<BigInt(t-1))-w,Y=t=>new Uint8Array(t),$=t=>Uint8Array.from(t);function G(t,e,r){if("number"!=typeof t||t<2)throw Error("hashLen must be a number");if("number"!=typeof e||e<2)throw Error("qByteLen must be a number");if("function"!=typeof r)throw Error("hmacFn must be a function");let n=Y(t),i=Y(t),s=0;const o=()=>{n.fill(1),i.fill(0),s=0},a=(...t)=>r(i,n,...t),h=(t=Y())=>{i=a($([0]),t),n=a(),0!==t.length&&(i=a($([1]),t),n=a())},l=()=>{if(s++>=1e3)throw Error("drbg: tried 1000 values");let t=0;const r=[];for(;t<e;){n=a();const e=n.slice();r.push(e),t+=n.length}return j(...r)};return(t,e)=>{let r;for(o(),h(t);!(r=e(l()));)h();return o(),r}}const J={bigint(t){return"bigint"==typeof t},function(t){return"function"==typeof t},boolean(t){return"boolean"==typeof t},string(t){return"string"==typeof t},stringOrUint8Array(t){return"string"==typeof t||v(t)},isSafeInteger(t){return Number.isSafeInteger(t)},array(t){return Array.isArray(t)},field(t,e){return e.Fp.isValid(t)},hash(t){return"function"==typeof t&&Number.isSafeInteger(t.outputLen)}};function X(t,e,r={}){const n=(e,r,n)=>{const i=J[r];if("function"!=typeof i)throw Error("invalid validator function");const s=t[e];if(!(n&&void 0===s||i(s,t)))throw Error("param "+e+" is invalid. Expected "+r+", got "+s)};for(const[t,r]of Object.entries(e))n(t,r,!1);for(const[t,e]of Object.entries(r))n(t,e,!0);return t}function Q(t){const e=new WeakMap;return(r,...n)=>{const i=e.get(r);if(void 0!==i)return i;const s=t(r,...n);return e.set(r,s),s}}var tt=Object.freeze({__proto__:null,aInRange:V,abool:x,abytes:E,bitGet(t,e){return t>>BigInt(e)&w},bitLen:K,bitMask:Z,bitSet(t,e,r){return t|(r?w:b)<<BigInt(e)},bytesToHex:T,bytesToNumberBE:D,bytesToNumberLE:q,concatBytes:j,createHmacDrbg:G,ensureBytes:H,equalBytes(t,e){if(t.length!==e.length)return!1;let r=0;for(let n=0;n<t.length;n++)r|=t[n]^e[n];return 0===r},hexToBytes:F,hexToNumber:k,inRange:W,isBytes:v,memoized:Q,notImplemented(){throw Error("not implemented")},numberToBytesBE:U,numberToBytesLE:M,numberToHexUnpadded:A,numberToVarBytesBE(t){return F(A(t))},utf8ToBytes(t){if("string"!=typeof t)throw Error("string expected");return new Uint8Array((new TextEncoder).encode(t))},validateObject:X});const et=BigInt(0),rt=BigInt(1),nt=BigInt(2),it=BigInt(3),st=BigInt(4),ot=BigInt(5),at=BigInt(8);function ht(t,e){const r=t%e;return r>=et?r:e+r}function lt(t,e,r){if(e<et)throw Error("invalid exponent, negatives unsupported");if(r<=et)throw Error("invalid modulus");if(r===rt)return et;let n=rt;for(;e>et;)e&rt&&(n=n*t%r),t=t*t%r,e>>=rt;return n}function ct(t,e,r){let n=t;for(;e-- >et;)n*=n,n%=r;return n}function dt(t,e){if(t===et)throw Error("invert: expected non-zero number");if(e<=et)throw Error("invert: expected positive modulus, got "+e);let r=ht(t,e),n=e,i=et,s=rt;for(;r!==et;){const t=n%r,e=i-s*(n/r);n=r,r=t,i=s,s=e}if(n!==rt)throw Error("invert: does not exist");return ht(i,e)}function ut(t){if(t%st===it){const e=(t+rt)/st;return function(t,r){const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw Error("Cannot find square root");return n}}if(t%at===ot){const e=(t-ot)/at;return function(t,r){const n=t.mul(r,nt),i=t.pow(n,e),s=t.mul(r,i),o=t.mul(t.mul(s,nt),i),a=t.mul(s,t.sub(o,t.ONE));if(!t.eql(t.sqr(a),r))throw Error("Cannot find square root");return a}}return function(t){const e=(t-rt)/nt;let r,n,i;for(r=t-rt,n=0;r%nt===et;r/=nt,n++);for(i=nt;i<t&&lt(i,e,t)!==t-rt;i++)if(i>1e3)throw Error("Cannot find square root: likely non-prime P");if(1===n){const e=(t+rt)/st;return(t,r)=>{const n=t.pow(r,e);if(!t.eql(t.sqr(n),r))throw Error("Cannot find square root");return n}}const s=(r+rt)/nt;return(t,o)=>{if(t.pow(o,e)===t.neg(t.ONE))throw Error("Cannot find square root");let a=n,h=t.pow(t.mul(t.ONE,i),r),l=t.pow(o,s),c=t.pow(o,r);for(;!t.eql(c,t.ONE);){if(t.eql(c,t.ZERO))return t.ZERO;let e=1;for(let r=t.sqr(c);e<a&&!t.eql(r,t.ONE);e++)r=t.sqr(r);const r=t.pow(h,rt<<BigInt(a-e-1));h=t.sqr(r),l=t.mul(l,r),c=t.mul(c,h),a=e}return l}}(t)}const ft=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function pt(t,e){const r=void 0!==e?e:t.toString(2).length;return{nBitLength:r,nByteLength:Math.ceil(r/8)}}function gt(t,e,r=!1,n={}){if(t<=et)throw Error("invalid field: expected ORDER > 0, got "+t);const{nBitLength:i,nByteLength:s}=pt(t,e);if(s>2048)throw Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:t,isLE:r,BITS:i,BYTES:s,MASK:Z(i),ZERO:et,ONE:rt,create(e){return ht(e,t)},isValid(e){if("bigint"!=typeof e)throw Error("invalid field element: expected bigint, got "+typeof e);return et<=e&&e<t},is0(t){return t===et},isOdd(t){return(t&rt)===rt},neg(e){return ht(-e,t)},eql(t,e){return t===e},sqr(e){return ht(e*e,t)},add(e,r){return ht(e+r,t)},sub(e,r){return ht(e-r,t)},mul(e,r){return ht(e*r,t)},pow(t,e){return function(t,e,r){if(r<et)throw Error("invalid exponent, negatives unsupported");if(r===et)return t.ONE;if(r===rt)return e;let n=t.ONE,i=e;for(;r>et;)r&rt&&(n=t.mul(n,i)),i=t.sqr(i),r>>=rt;return n}(a,t,e)},div(e,r){return ht(e*dt(r,t),t)},sqrN(t){return t*t},addN(t,e){return t+e},subN(t,e){return t-e},mulN(t,e){return t*e},inv(e){return dt(e,t)},sqrt:n.sqrt||(e=>(o||(o=ut(t)),o(a,e))),invertBatch(t){return function(t,e){const r=Array(e.length),n=e.reduce(((e,n,i)=>t.is0(n)?e:(r[i]=e,t.mul(e,n))),t.ONE),i=t.inv(n);return e.reduceRight(((e,n,i)=>t.is0(n)?e:(r[i]=t.mul(e,r[i]),t.mul(e,n))),i),r}(a,t)},cmov(t,e,r){return r?e:t},toBytes(t){return r?M(t,s):U(t,s)},fromBytes(t){if(t.length!==s)throw Error("Field.fromBytes: expected "+s+" bytes, got "+t.length);return r?q(t):D(t)}});return Object.freeze(a)}function mt(t){if("bigint"!=typeof t)throw Error("field order must be bigint");const e=t.toString(2).length;return Math.ceil(e/8)}function yt(t){const e=mt(t);return e+Math.ceil(e/2)}const _t=BigInt(0),bt=BigInt(1);function wt(t,e){const r=e.negate();return t?r:e}function St(t,e){if(!Number.isSafeInteger(t)||t<=0||t>e)throw Error("invalid window size, expected [1.."+e+"], got W="+t)}function vt(t,e){St(t,e);return{windows:Math.ceil(e/t)+1,windowSize:2**(t-1)}}const Et=new WeakMap,xt=new WeakMap;function Ct(t){return xt.get(t)||1}function Tt(t,e,r,n){if(function(t,e){if(!Array.isArray(t))throw Error("array expected");t.forEach(((t,r)=>{if(!(t instanceof e))throw Error("invalid point at index "+r)}))}(r,t),function(t,e){if(!Array.isArray(t))throw Error("array of scalars expected");t.forEach(((t,r)=>{if(!e.isValid(t))throw Error("invalid scalar at index "+r)}))}(n,e),r.length!==n.length)throw Error("arrays of points and scalars must have equal length");const i=t.ZERO,s=K(BigInt(r.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,h=Array(a+1).fill(i);let l=i;for(let t=Math.floor((e.BITS-1)/o)*o;t>=0;t-=o){h.fill(i);for(let e=0;e<n.length;e++){const i=n[e],s=Number(i>>BigInt(t)&BigInt(a));h[s]=h[s].add(r[e])}let e=i;for(let t=h.length-1,r=i;t>0;t--)r=r.add(h[t]),e=e.add(r);if(l=l.add(e),0!==t)for(let t=0;t<o;t++)l=l.double()}return l}function At(t){return X(t.Fp,ft.reduce(((t,e)=>(t[e]="function",t)),{ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"})),X(t,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...pt(t.n,t.nBitLength),...t,p:t.Fp.ORDER})}function kt(t){void 0!==t.lowS&&x("lowS",t.lowS),void 0!==t.prehash&&x("prehash",t.prehash)}const{bytesToNumberBE:Rt,hexToBytes:Nt}=tt;const Bt={Err:class extends Error{constructor(t=""){super(t)}},_tlv:{encode(t,e){const{Err:r}=Bt;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(1&e.length)throw new r("tlv.encode: unpadded data");const n=e.length/2,i=A(n);if(i.length/2&128)throw new r("tlv.encode: long form length too big");const s=n>127?A(i.length/2|128):"";return A(t)+s+i+e},decode(t,e){const{Err:r}=Bt;let n=0;if(t<0||t>256)throw new r("tlv.encode: wrong tag");if(e.length<2||e[n++]!==t)throw new r("tlv.decode: wrong tlv");const i=e[n++];let s=0;if(!!(128&i)){const t=127&i;if(!t)throw new r("tlv.decode(long): indefinite length not supported");if(t>4)throw new r("tlv.decode(long): byte length is too big");const o=e.subarray(n,n+t);if(o.length!==t)throw new r("tlv.decode: length bytes not complete");if(0===o[0])throw new r("tlv.decode(long): zero leftmost byte");for(const t of o)s=s<<8|t;if(n+=t,s<128)throw new r("tlv.decode(long): not minimal encoding")}else s=i;const o=e.subarray(n,n+s);if(o.length!==s)throw new r("tlv.decode: wrong value length");return{v:o,l:e.subarray(n+s)}}},_int:{encode(t){const{Err:e}=Bt;if(t<It)throw new e("integer: negative integers are not allowed");let r=A(t);if(8&Number.parseInt(r[0],16)&&(r="00"+r),1&r.length)throw new e("unexpected DER parsing assertion: unpadded hex");return r},decode(t){const{Err:e}=Bt;if(128&t[0])throw new e("invalid signature integer: negative");if(0===t[0]&&!(128&t[1]))throw new e("invalid signature integer: unnecessary leading zero");return Rt(t)}},toSig(t){const{Err:e,_int:r,_tlv:n}=Bt,i="string"==typeof t?Nt(t):t;E(i);const{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:h}=n.decode(2,s),{v:l,l:c}=n.decode(2,h);if(c.length)throw new e("invalid signature: left bytes after parsing");return{r:r.decode(a),s:r.decode(l)}},hexFromSig(t){const{_tlv:e,_int:r}=Bt,n=e.encode(2,r.encode(t.r))+e.encode(2,r.encode(t.s));return e.encode(48,n)}},It=BigInt(0),Ot=BigInt(1);BigInt(2);const Lt=BigInt(3);function Pt(t){const e=function(t){const e=At(t);X(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:r,Fp:n,a:i}=e;if(r){if(!n.eql(i,n.ZERO))throw Error("invalid endomorphism, can only be defined for Koblitz curves that have a=0");if("object"!=typeof r||"bigint"!=typeof r.beta||"function"!=typeof r.splitScalar)throw Error("invalid endomorphism, expected beta: bigint and splitScalar: function")}return Object.freeze({...e})}(t),{Fp:r}=e,n=gt(e.n,e.nBitLength),i=e.toBytes||((t,e)=>{const n=e.toAffine();return j(Uint8Array.from([4]),r.toBytes(n.x),r.toBytes(n.y))}),s=e.fromBytes||(t=>{const e=t.subarray(1);return{x:r.fromBytes(e.subarray(0,r.BYTES)),y:r.fromBytes(e.subarray(r.BYTES,2*r.BYTES))}});function o(t){const{a:n,b:i}=e,s=r.sqr(t),o=r.mul(s,t);return r.add(r.add(o,r.mul(t,n)),i)}if(!r.eql(r.sqr(e.Gy),o(e.Gx)))throw Error("bad generator point: equation left != right");function a(t){const{allowedPrivateKeyLengths:r,nByteLength:n,wrapPrivateKey:i,n:s}=e;if(r&&"bigint"!=typeof t){if(v(t)&&(t=T(t)),"string"!=typeof t||!r.includes(t.length))throw Error("invalid private key");t=t.padStart(2*n,"0")}let o;try{o="bigint"==typeof t?t:D(H("private key",t,n))}catch(e){throw Error("invalid private key, expected hex or "+n+" bytes, got "+typeof t)}return i&&(o=ht(o,s)),V("private key",o,Ot,s),o}function h(t){if(!(t instanceof d))throw Error("ProjectivePoint expected")}const l=Q(((t,e)=>{const{px:n,py:i,pz:s}=t;if(r.eql(s,r.ONE))return{x:n,y:i};const o=t.is0();null==e&&(e=o?r.ONE:r.inv(s));const a=r.mul(n,e),h=r.mul(i,e),l=r.mul(s,e);if(o)return{x:r.ZERO,y:r.ZERO};if(!r.eql(l,r.ONE))throw Error("invZ was invalid");return{x:a,y:h}})),c=Q((t=>{if(t.is0()){if(e.allowInfinityPoint&&!r.is0(t.py))return;throw Error("bad point: ZERO")}const{x:n,y:i}=t.toAffine();if(!r.isValid(n)||!r.isValid(i))throw Error("bad point: x or y not FE");const s=r.sqr(i),a=o(n);if(!r.eql(s,a))throw Error("bad point: equation left != right");if(!t.isTorsionFree())throw Error("bad point: not in prime-order subgroup");return!0}));class d{constructor(t,e,n){if(this.px=t,this.py=e,this.pz=n,null==t||!r.isValid(t))throw Error("x required");if(null==e||!r.isValid(e))throw Error("y required");if(null==n||!r.isValid(n))throw Error("z required");Object.freeze(this)}static fromAffine(t){const{x:e,y:n}=t||{};if(!t||!r.isValid(e)||!r.isValid(n))throw Error("invalid affine point");if(t instanceof d)throw Error("projective point not allowed");const i=t=>r.eql(t,r.ZERO);return i(e)&&i(n)?d.ZERO:new d(e,n,r.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(t){const e=r.invertBatch(t.map((t=>t.pz)));return t.map(((t,r)=>t.toAffine(e[r]))).map(d.fromAffine)}static fromHex(t){const e=d.fromAffine(s(H("pointHex",t)));return e.assertValidity(),e}static fromPrivateKey(t){return d.BASE.multiply(a(t))}static msm(t,e){return Tt(d,n,t,e)}_setWindowSize(t){f.setWindowSize(this,t)}assertValidity(){c(this)}hasEvenY(){const{y:t}=this.toAffine();if(r.isOdd)return!r.isOdd(t);throw Error("Field doesn't support isOdd")}equals(t){h(t);const{px:e,py:n,pz:i}=this,{px:s,py:o,pz:a}=t,l=r.eql(r.mul(e,a),r.mul(s,i)),c=r.eql(r.mul(n,a),r.mul(o,i));return l&&c}negate(){return new d(this.px,r.neg(this.py),this.pz)}double(){const{a:t,b:n}=e,i=r.mul(n,Lt),{px:s,py:o,pz:a}=this;let h=r.ZERO,l=r.ZERO,c=r.ZERO,u=r.mul(s,s),f=r.mul(o,o),p=r.mul(a,a),g=r.mul(s,o);return g=r.add(g,g),c=r.mul(s,a),c=r.add(c,c),h=r.mul(t,c),l=r.mul(i,p),l=r.add(h,l),h=r.sub(f,l),l=r.add(f,l),l=r.mul(h,l),h=r.mul(g,h),c=r.mul(i,c),p=r.mul(t,p),g=r.sub(u,p),g=r.mul(t,g),g=r.add(g,c),c=r.add(u,u),u=r.add(c,u),u=r.add(u,p),u=r.mul(u,g),l=r.add(l,u),p=r.mul(o,a),p=r.add(p,p),u=r.mul(p,g),h=r.sub(h,u),c=r.mul(p,f),c=r.add(c,c),c=r.add(c,c),new d(h,l,c)}add(t){h(t);const{px:n,py:i,pz:s}=this,{px:o,py:a,pz:l}=t;let c=r.ZERO,u=r.ZERO,f=r.ZERO;const p=e.a,g=r.mul(e.b,Lt);let m=r.mul(n,o),y=r.mul(i,a),_=r.mul(s,l),b=r.add(n,i),w=r.add(o,a);b=r.mul(b,w),w=r.add(m,y),b=r.sub(b,w),w=r.add(n,s);let S=r.add(o,l);return w=r.mul(w,S),S=r.add(m,_),w=r.sub(w,S),S=r.add(i,s),c=r.add(a,l),S=r.mul(S,c),c=r.add(y,_),S=r.sub(S,c),f=r.mul(p,w),c=r.mul(g,_),f=r.add(c,f),c=r.sub(y,f),f=r.add(y,f),u=r.mul(c,f),y=r.add(m,m),y=r.add(y,m),_=r.mul(p,_),w=r.mul(g,w),y=r.add(y,_),_=r.sub(m,_),_=r.mul(p,_),w=r.add(w,_),m=r.mul(y,w),u=r.add(u,m),m=r.mul(S,w),c=r.mul(b,c),c=r.sub(c,m),m=r.mul(b,y),f=r.mul(S,f),f=r.add(f,m),new d(c,u,f)}subtract(t){return this.add(t.negate())}is0(){return this.equals(d.ZERO)}wNAF(t){return f.wNAFCached(this,t,d.normalizeZ)}multiplyUnsafe(t){const{endo:n,n:i}=e;V("scalar",t,It,i);const s=d.ZERO;if(t===It)return s;if(this.is0()||t===Ot)return this;if(!n||f.hasPrecomputes(this))return f.wNAFCachedUnsafe(this,t,d.normalizeZ);let{k1neg:o,k1:a,k2neg:h,k2:l}=n.splitScalar(t),c=s,u=s,p=this;for(;a>It||l>It;)a&Ot&&(c=c.add(p)),l&Ot&&(u=u.add(p)),p=p.double(),a>>=Ot,l>>=Ot;return o&&(c=c.negate()),h&&(u=u.negate()),u=new d(r.mul(u.px,n.beta),u.py,u.pz),c.add(u)}multiply(t){const{endo:n,n:i}=e;let s,o;if(V("scalar",t,Ot,i),n){const{k1neg:e,k1:i,k2neg:a,k2:h}=n.splitScalar(t);let{p:l,f:c}=this.wNAF(i),{p:u,f:p}=this.wNAF(h);l=f.constTimeNegate(e,l),u=f.constTimeNegate(a,u),u=new d(r.mul(u.px,n.beta),u.py,u.pz),s=l.add(u),o=c.add(p)}else{const{p:e,f:r}=this.wNAF(t);s=e,o=r}return d.normalizeZ([s,o])[0]}multiplyAndAddUnsafe(t,e,r){const n=d.BASE,i=(t,e)=>e!==It&&e!==Ot&&t.equals(n)?t.multiply(e):t.multiplyUnsafe(e),s=i(this,e).add(i(t,r));return s.is0()?void 0:s}toAffine(t){return l(this,t)}isTorsionFree(){const{h:t,isTorsionFree:r}=e;if(t===Ot)return!0;if(r)return r(d,this);throw Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:t,clearCofactor:r}=e;return t===Ot?this:r?r(d,this):this.multiplyUnsafe(e.h)}toRawBytes(t=!0){return x("isCompressed",t),this.assertValidity(),i(d,this,t)}toHex(t=!0){return x("isCompressed",t),T(this.toRawBytes(t))}}d.BASE=new d(e.Gx,e.Gy,r.ONE),d.ZERO=new d(r.ZERO,r.ONE,r.ZERO);const u=e.nBitLength,f=(p=d,g=e.endo?Math.ceil(u/2):u,{constTimeNegate:wt,hasPrecomputes:t=>1!==Ct(t),unsafeLadder(t,e,r=p.ZERO){let n=t;for(;e>_t;)e&bt&&(r=r.add(n)),n=n.double(),e>>=bt;return r},precomputeWindow(t,e){const{windows:r,windowSize:n}=vt(e,g),i=[];let s=t,o=s;for(let t=0;t<r;t++){o=s,i.push(o);for(let t=1;t<n;t++)o=o.add(s),i.push(o);s=o.double()}return i},wNAF(t,e,r){const{windows:n,windowSize:i}=vt(t,g);let s=p.ZERO,o=p.BASE;const a=BigInt(2**t-1),h=2**t,l=BigInt(t);for(let t=0;t<n;t++){const n=t*i;let c=Number(r&a);r>>=l,c>i&&(c-=h,r+=bt);const d=n,u=n+Math.abs(c)-1,f=t%2!=0,p=c<0;0===c?o=o.add(wt(f,e[d])):s=s.add(wt(p,e[u]))}return{p:s,f:o}},wNAFUnsafe(t,e,r,n=p.ZERO){const{windows:i,windowSize:s}=vt(t,g),o=BigInt(2**t-1),a=2**t,h=BigInt(t);for(let t=0;t<i;t++){const i=t*s;if(r===_t)break;let l=Number(r&o);if(r>>=h,l>s&&(l-=a,r+=bt),0===l)continue;let c=e[i+Math.abs(l)-1];l<0&&(c=c.negate()),n=n.add(c)}return n},getPrecomputes(t,e,r){let n=Et.get(e);return n||(n=this.precomputeWindow(e,t),1!==t&&Et.set(e,r(n))),n},wNAFCached(t,e,r){const n=Ct(t);return this.wNAF(n,this.getPrecomputes(n,t,r),e)},wNAFCachedUnsafe(t,e,r,n){const i=Ct(t);return 1===i?this.unsafeLadder(t,e,n):this.wNAFUnsafe(i,this.getPrecomputes(i,t,r),e,n)},setWindowSize(t,e){St(e,g),xt.set(t,e),Et.delete(t)}});var p,g;return{CURVE:e,ProjectivePoint:d,normPrivateKeyToScalar:a,weierstrassEquation:o,isWithinCurveOrder(t){return W(t,Ot,e.n)}}}function Ft(t){const e=function(t){const e=At(t);return X(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}(t),{Fp:r,n}=e,i=r.BYTES+1,s=2*r.BYTES+1;function o(t){return ht(t,n)}function a(t){return dt(t,n)}const{ProjectivePoint:h,normPrivateKeyToScalar:l,weierstrassEquation:c,isWithinCurveOrder:d}=Pt({...e,toBytes(t,e,n){const i=e.toAffine(),s=r.toBytes(i.x),o=j;return x("isCompressed",n),n?o(Uint8Array.from([e.hasEvenY()?2:3]),s):o(Uint8Array.from([4]),s,r.toBytes(i.y))},fromBytes(t){const e=t.length,n=t[0],o=t.subarray(1);if(e!==i||2!==n&&3!==n){if(e===s&&4===n){return{x:r.fromBytes(o.subarray(0,r.BYTES)),y:r.fromBytes(o.subarray(r.BYTES,2*r.BYTES))}}throw Error("invalid Point, expected length of "+i+", or uncompressed "+s+", got "+e)}{const t=D(o);if(!W(t,Ot,r.ORDER))throw Error("Point is not on curve");const e=c(t);let i;try{i=r.sqrt(e)}catch(t){const e=t instanceof Error?": "+t.message:"";throw Error("Point is not on curve"+e)}return!(1&~n)!==((i&Ot)===Ot)&&(i=r.neg(i)),{x:t,y:i}}}}),u=t=>T(U(t,e.nByteLength));function f(t){return t>n>>Ot}const p=(t,e,r)=>D(t.slice(e,r));class g{constructor(t,e,r){this.r=t,this.s=e,this.recovery=r,this.assertValidity()}static fromCompact(t){const r=e.nByteLength;return t=H("compactSignature",t,2*r),new g(p(t,0,r),p(t,r,2*r))}static fromDER(t){const{r:e,s:r}=Bt.toSig(H("DER",t));return new g(e,r)}assertValidity(){V("r",this.r,Ot,n),V("s",this.s,Ot,n)}addRecoveryBit(t){return new g(this.r,this.s,t)}recoverPublicKey(t){const{r:n,s:i,recovery:s}=this,l=b(H("msgHash",t));if(null==s||![0,1,2,3].includes(s))throw Error("recovery id invalid");const c=2===s||3===s?n+e.n:n;if(c>=r.ORDER)throw Error("recovery id 2 or 3 invalid");const d=1&s?"03":"02",f=h.fromHex(d+u(c)),p=a(c),g=o(-l*p),m=o(i*p),y=h.BASE.multiplyAndAddUnsafe(f,g,m);if(!y)throw Error("point at infinify");return y.assertValidity(),y}hasHighS(){return f(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o(-this.s),this.recovery):this}toDERRawBytes(){return F(this.toDERHex())}toDERHex(){return Bt.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return F(this.toCompactHex())}toCompactHex(){return u(this.r)+u(this.s)}}const m={isValidPrivateKey(t){try{return l(t),!0}catch(t){return!1}},normPrivateKeyToScalar:l,randomPrivateKey(){const t=yt(e.n);return function(t,e,r=!1){const n=t.length,i=mt(e),s=yt(e);if(n<16||n<s||n>1024)throw Error("expected "+s+"-1024 bytes of input, got "+n);const o=ht(r?q(t):D(t),e-rt)+rt;return r?M(o,i):U(o,i)}(e.randomBytes(t),e.n)},precompute:(t=8,e=h.BASE)=>(e._setWindowSize(t),e.multiply(BigInt(3)),e)};function y(t){const e=v(t),r="string"==typeof t,n=(e||r)&&t.length;return e?n===i||n===s:r?n===2*i||n===2*s:t instanceof h}const _=e.bits2int||(t=>{if(t.length>8192)throw Error("input is too large");const r=D(t),n=8*t.length-e.nBitLength;return n>0?r>>BigInt(n):r}),b=e.bits2int_modN||(t=>o(_(t))),w=Z(e.nBitLength);function S(t){return V("num < 2^"+e.nBitLength,t,It,w),U(t,e.nByteLength)}function E(t,n,i=C){if(["recovered","canonical"].some((t=>t in i)))throw Error("sign() legacy options not supported");const{hash:s,randomBytes:c}=e;let{lowS:u,prehash:p,extraEntropy:m}=i;null==u&&(u=!0),t=H("msgHash",t),kt(i),p&&(t=H("prehashed msgHash",s(t)));const y=b(t),w=l(n),v=[S(w),S(y)];if(null!=m&&!1!==m){const t=!0===m?c(r.BYTES):m;v.push(H("extraEntropy",t))}const E=j(...v),x=y;return{seed:E,k2sig(t){const e=_(t);if(!d(e))return;const r=a(e),n=h.BASE.multiply(e).toAffine(),i=o(n.x);if(i===It)return;const s=o(r*o(x+i*w));if(s===It)return;let l=(n.x===i?0:2)|Number(n.y&Ot),c=s;return u&&f(s)&&(c=function(t){return f(t)?o(-t):t}(s),l^=1),new g(i,c,l)}}}const C={lowS:e.lowS,prehash:!1},A={lowS:e.lowS,prehash:!1};return h.BASE._setWindowSize(8),{CURVE:e,getPublicKey(t,e=!0){return h.fromPrivateKey(t).toRawBytes(e)},getSharedSecret(t,e,r=!0){if(y(t))throw Error("first arg must be private key");if(!y(e))throw Error("second arg must be public key");return h.fromHex(e).multiply(l(t)).toRawBytes(r)},sign(t,r,n=C){const{seed:i,k2sig:s}=E(t,r,n),o=e;return G(o.hash.outputLen,o.nByteLength,o.hmac)(i,s)},verify(t,r,n,i=A){const s=t;r=H("msgHash",r),n=H("publicKey",n);const{lowS:l,prehash:c,format:d}=i;if(kt(i),"strict"in i)throw Error("options.strict was renamed to lowS");if(void 0!==d&&"compact"!==d&&"der"!==d)throw Error("format must be compact or der");const u="string"==typeof s||v(s),f=!u&&!d&&"object"==typeof s&&null!==s&&"bigint"==typeof s.r&&"bigint"==typeof s.s;if(!u&&!f)throw Error("invalid signature, expected Uint8Array, hex string or Signature instance");let p,m;try{if(f&&(p=new g(s.r,s.s)),u){try{"compact"!==d&&(p=g.fromDER(s))}catch(t){if(!(t instanceof Bt.Err))throw t}p||"der"===d||(p=g.fromCompact(s))}m=h.fromHex(n)}catch(t){return!1}if(!p)return!1;if(l&&p.hasHighS())return!1;c&&(r=e.hash(r));const{r:y,s:_}=p,w=b(r),S=a(_),E=o(w*S),x=o(y*S),C=h.BASE.multiplyAndAddUnsafe(m,E,x)?.toAffine();return!!C&&o(C.x)===y},ProjectivePoint:h,Signature:g,utils:m}}function Dt(t){return{hash:t,hmac(r,...n){return _(t,r,function(...t){let r=0;for(let n=0;n<t.length;n++){const i=t[n];e(i),r+=i.length}const n=new Uint8Array(r);for(let e=0,r=0;e<t.length;e++){const i=t[e];n.set(i,r),r+=i.length}return n}(...n))},randomBytes:l}}BigInt(4);const qt=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Ut=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),Mt=BigInt(1),Ht=BigInt(2),jt=(t,e)=>(t+e/Ht)/e;function zt(t){const e=qt,r=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),h=BigInt(88),l=t*t*t%e,c=l*l*t%e,d=ct(c,r,e)*c%e,u=ct(d,r,e)*c%e,f=ct(u,Ht,e)*l%e,p=ct(f,i,e)*f%e,g=ct(p,s,e)*p%e,m=ct(g,a,e)*g%e,y=ct(m,h,e)*m%e,_=ct(y,a,e)*g%e,b=ct(_,r,e)*c%e,w=ct(b,o,e)*p%e,S=ct(w,n,e)*l%e,v=ct(S,Ht,e);if(!Wt.eql(Wt.sqr(v),t))throw Error("Cannot find square root");return v}const Wt=gt(qt,void 0,void 0,{sqrt:zt}),Vt=function(t,e){const r=e=>Ft({...t,...Dt(e)});return{...r(e),create:r}}({a:BigInt(0),b:BigInt(7),Fp:Wt,n:Ut,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(t){const e=Ut,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-Mt*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=r,o=BigInt("0x100000000000000000000000000000000"),a=jt(s*t,e),h=jt(-n*t,e);let l=ht(t-a*r-h*i,e),c=ht(-a*n-h*s,e);const d=l>o,u=c>o;if(d&&(l=e-l),u&&(c=e-c),l>o||c>o)throw Error("splitScalar: Endomorphism failed, k="+t);return{k1neg:d,k1:l,k2neg:u,k2:c}}}},m),Kt=BigInt(0),Zt={};function Yt(t,...e){let r=Zt[t];if(void 0===r){const e=m(Uint8Array.from(t,(t=>t.charCodeAt(0))));r=j(e,e),Zt[t]=r}return m(j(r,...e))}const $t=t=>t.toRawBytes(!0).slice(1),Gt=t=>U(t,32),Jt=t=>ht(t,qt),Xt=t=>ht(t,Ut),Qt=Vt.ProjectivePoint;function te(t){let e=Vt.utils.normPrivateKeyToScalar(t),r=Qt.fromPrivateKey(e);return{scalar:r.hasEvenY()?e:Xt(-e),bytes:$t(r)}}function ee(t){V("x",t,Mt,qt);const e=Jt(t*t);let r=zt(Jt(e*t+BigInt(7)));r%Ht!==Kt&&(r=Jt(-r));const n=new Qt(t,r,Mt);return n.assertValidity(),n}const re=D;function ne(...t){return Xt(re(Yt("BIP0340/challenge",...t)))}function ie(t){return te(t).bytes}function se(t,e,r=l(32)){const n=H("message",t),{bytes:i,scalar:s}=te(e),o=H("auxRand",r,32),a=Gt(s^re(Yt("BIP0340/aux",o))),h=Yt("BIP0340/nonce",a,i,n),c=Xt(re(h));if(c===Kt)throw Error("sign failed: k is zero");const{bytes:d,scalar:u}=te(c),f=ne(d,i,n),p=new Uint8Array(64);if(p.set(d,0),p.set(Gt(Xt(u+f*s)),32),!oe(p,n,i))throw Error("sign: Invalid signature produced");return p}function oe(t,e,r){const n=H("signature",t,64),i=H("message",e),s=H("publicKey",r,32);try{const t=ee(re(s)),e=re(n.subarray(0,32));if(!W(e,Mt,qt))return!1;const r=re(n.subarray(32,64));if(!W(r,Mt,Ut))return!1;const l=ne(Gt(e),$t(t),i),c=(o=t,a=r,h=Xt(-l),Qt.BASE.multiplyAndAddUnsafe(o,a,h));return!(!c||!c.hasEvenY()||c.toAffine().x!==e)}catch(t){return!1}var o,a,h}const ae=(()=>({getPublicKey:ie,sign:se,verify:oe,utils:{randomPrivateKey:Vt.utils.randomPrivateKey,lift_x:ee,pointToBytes:$t,numberToBytesBE:U,bytesToNumberBE:D,taggedHash:Yt,mod:ht}}))(),{floor:he,random:le,sin:ce}=Math,de="Trystero",ue=(t,e)=>Array(t).fill().map(e),fe="0123456789AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz",pe=t=>ue(t,(()=>fe[he(62*le())])).join(""),ge=pe(20),me=Promise.all.bind(Promise),ye="undefined"!=typeof window,{entries:_e,fromEntries:be,keys:we}=Object,Se=()=>{},ve=t=>Error(`${de}: ${t}`),Ee=new TextEncoder,xe=new TextDecoder,Ce=t=>Ee.encode(t),Te=t=>xe.decode(t),Ae=t=>t.reduce(((t,e)=>t+e.toString(16).padStart(2,"0")),""),ke=(...t)=>t.join("@"),Re=(t,e,r)=>{const n=t.relayUrls||((t,e)=>{const r=[...t],n=()=>{const t=1e4*ce(e++);return t-he(t)};let i=r.length;for(;i;){const t=he(n()*i--);[r[i],r[t]]=[r[t],r[i]]}return r})(e,Ie(t.appId));return n.slice(0,t.relayUrls?t.relayUrls.length:t.relayRedundancy||r)},Ne=JSON.stringify,Be=JSON.parse,Ie=(t,e=Number.MAX_SAFE_INTEGER)=>t.split("").reduce(((t,e)=>t+e.charCodeAt(0)),0)%e,Oe={},Le="AES-GCM",Pe={},Fe=async t=>{if(Pe[t])return Pe[t];const e=Array.from(new Uint8Array(await crypto.subtle.digest("SHA-1",Ce(t)))).map((t=>t.toString(36))).join("");return Pe[t]=e,e},De=async(t,e)=>{const r=crypto.getRandomValues(new Uint8Array(16));return r.join(",")+"$"+(n=await crypto.subtle.encrypt({name:Le,iv:r},await t,Ce(e)),btoa(String.fromCharCode.apply(null,new Uint8Array(n))));var n},qe=async(t,e)=>{const[r,n]=e.split("$");return Te(await crypto.subtle.decrypt({name:Le,iv:new Uint8Array(r.split(","))},await t,(t=>{const e=atob(t);return new Uint8Array(e.length).map(((t,r)=>e.charCodeAt(r))).buffer})(n)))};function Ue(t){return t&&t.__esModule&&{}.hasOwnProperty.call(t,"default")?t.default:t}var Me,He,je,ze,We,Ve={exports:{}};function Ke(){if(He)return Me;He=1;var t=1e3,e=60*t,r=60*e,n=24*r,i=7*n,s=365.25*n;function o(t,e,r,n){var i=e>=1.5*r;return Math.round(t/r)+" "+n+(i?"s":"")}return Me=(a,h)=>{h=h||{};var l=typeof a;if("string"===l&&a.length>0)return function(o){if((o+="").length>100)return;var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(o);if(!a)return;var h=parseFloat(a[1]);switch((a[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return h*s;case"weeks":case"week":case"w":return h*i;case"days":case"day":case"d":return h*n;case"hours":case"hour":case"hrs":case"hr":case"h":return h*r;case"minutes":case"minute":case"mins":case"min":case"m":return h*e;case"seconds":case"second":case"secs":case"sec":case"s":return h*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return h;default:return}}(a);if("number"===l&&isFinite(a))return h.long?function(i){var s=Math.abs(i);if(s>=n)return o(i,s,n,"day");if(s>=r)return o(i,s,r,"hour");if(s>=e)return o(i,s,e,"minute");if(s>=t)return o(i,s,t,"second");return i+" ms"}(a):function(i){var s=Math.abs(i);if(s>=n)return Math.round(i/n)+"d";if(s>=r)return Math.round(i/r)+"h";if(s>=e)return Math.round(i/e)+"m";if(s>=t)return Math.round(i/t)+"s";return i+"ms"}(a);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(a))}}var Ze=(We||(We=1,function(t,e){e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const r="color: "+this.color;e.splice(1,0,r,"color: inherit");let n=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(n++,"%c"===t&&(i=n))})),e.splice(i,0,r)},e.save=t=>{try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=()=>{let t;try{t=e.storage.getItem("debug")}catch(t){}return!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG),t},e.useColors=()=>{if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let t;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&(t=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(t[1],10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=(()=>{try{return localStorage}catch(t){}})(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=(ze||(ze=1,je=function(t){function e(t){let n,i,s,o=null;function a(...t){if(!a.enabled)return;const r=a,i=Number(new Date),s=i-(n||i);r.diff=s,r.prev=n,r.curr=i,n=i,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";o++;const s=e.formatters[i];if("function"==typeof s){const e=t[o];n=s.call(r,e),t.splice(o,1),o--}return n})),e.formatArgs.call(r,t),(r.log||e.log).apply(r,t)}return a.namespace=t,a.useColors=e.useColors(),a.color=e.selectColor(t),a.extend=r,a.destroy=e.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(i!==e.namespaces&&(i=e.namespaces,s=e.enabled(t)),s),set(t){o=t}}),"function"==typeof e.init&&e.init(a),a}function r(t,r){const n=e(this.namespace+(void 0===r?":":r)+t);return n.log=this.log,n}function n(t,e){let r=0,n=0,i=-1,s=0;for(;r<t.length;)if(n<e.length&&(e[n]===t[r]||"*"===e[n]))"*"===e[n]?(i=n,s=r,n++):(r++,n++);else{if(-1===i)return!1;n=i+1,s++,r=s}for(;n<e.length&&"*"===e[n];)n++;return n===e.length}return e.debug=e,e.default=e,e.coerce=t=>t instanceof Error?t.stack||t.message:t,e.disable=()=>{const t=[...e.names,...e.skips.map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=t=>{e.save(t),e.namespaces=t,e.names=[],e.skips=[];const r=("string"==typeof t?t:"").trim().replace(" ",",").split(",").filter(Boolean);for(const t of r)"-"===t[0]?e.skips.push(t.slice(1)):e.names.push(t)},e.enabled=t=>{for(const r of e.skips)if(n(t,r))return!1;for(const r of e.names)if(n(t,r))return!0;return!1},e.humanize=Ke(),e.destroy=()=>{console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((r=>{e[r]=t[r]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=t=>{let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return e.colors[Math.abs(r)%e.colors.length]},e.enable(e.load()),e}),je)(e);const{formatters:r}=t.exports;r.j=t=>{try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}(Ve,Ve.exports)),Ve.exports),Ye=Ue(Ze);const $e="undefined"!=typeof window?window:self,Ge=$e.RTCPeerConnection||$e.mozRTCPeerConnection||$e.webkitRTCPeerConnection,Je=$e.RTCSessionDescription||$e.mozRTCSessionDescription||$e.webkitRTCSessionDescription,Xe=$e.RTCIceCandidate||$e.mozRTCIceCandidate||$e.webkitRTCIceCandidate;var Qe,tr,er,rr,nr,ir,sr,or,ar,hr,lr,cr={exports:{}};function dr(){if(Qe)return cr.exports;Qe=1;var t,e="object"==typeof Reflect?Reflect:null,r=e&&"function"==typeof e.apply?e.apply:function(t,e,r){return function(){}.apply.call(t,e,r)};t=e&&"function"==typeof e.ownKeys?e.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var n=Number.isNaN||function(t){return t!=t};function i(){i.init.call(this)}cr.exports=i,cr.exports.once=function(t,e){return new Promise(((r,n)=>{function i(r){t.removeListener(e,s),n(r)}function s(){"function"==typeof t.removeListener&&t.removeListener("error",i),r([].slice.call(arguments))}p(t,e,s,{once:!0}),"error"!==e&&function(t,e,r){"function"==typeof t.on&&p(t,"error",e,r)}(t,i,{once:!0})}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var s=10;function o(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function a(t){return void 0===t._maxListeners?i.defaultMaxListeners:t._maxListeners}function h(t,e,r,n){var i,s,h,l;if(o(r),void 0===(s=t._events)?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),h=s[e]),void 0===h)h=s[e]=r,++t._eventsCount;else if("function"==typeof h?h=s[e]=n?[r,h]:[h,r]:n?h.unshift(r):h.push(r),(i=a(t))>0&&h.length>i&&!h.warned){h.warned=!0;var c=Error("Possible EventEmitter memory leak detected. "+h.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=h.length,l=c,console&&console.warn&&console.warn(l)}return t}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(t,e,r){var n={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function d(t,e,r){var n=t._events;if(void 0===n)return[];var i=n[e];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(t){for(var e=Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}(i):f(i,i.length)}function u(t){var e=this._events;if(void 0!==e){var r=e[t];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(t,e){for(var r=Array(e),n=0;n<e;++n)r[n]=t[n];return r}function p(t,e,r,n){if("function"==typeof t.on)n.once?t.once(e,r):t.on(e,r);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){n.once&&t.removeEventListener(e,i),r(s)}))}}return Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get(){return s},set(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||n(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},i.prototype.getMaxListeners=function(){return a(this)},i.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var h=s[t];if(void 0===h)return!1;if("function"==typeof h)r(h,this,e);else{var l=h.length,c=f(h,l);for(n=0;n<l;++n)r(c[n],this,e)}return!0},i.prototype.addListener=function(t,e){return h(this,t,e,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(t,e){return h(this,t,e,!0)},i.prototype.once=function(t,e){return o(e),this.on(t,c(this,t,e)),this},i.prototype.prependOnceListener=function(t,e){return o(e),this.prependListener(t,c(this,t,e)),this},i.prototype.removeListener=function(t,e){var r,n,i,s,a;if(o(e),void 0===(n=this._events))return this;if(void 0===(r=n[t]))return this;if(r===e||r.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete n[t],n.removeListener&&this.emit("removeListener",t,r.listener||e));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===e||r[s].listener===e){a=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(r,i),1===r.length&&(n[t]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",t,a||e)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(t){var e,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[t]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=r[t]))this.removeListener(t,e);else if(void 0!==e)for(n=e.length-1;n>=0;n--)this.removeListener(t,e[n]);return this},i.prototype.listeners=function(t){return d(this,t,!0)},i.prototype.rawListeners=function(t){return d(this,t,!1)},i.listenerCount=(t,e)=>"function"==typeof t.listenerCount?t.listenerCount(e):u.call(t,e),i.prototype.listenerCount=u,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]},cr.exports}function ur(){if(nr)return rr;nr=1;const t=er?tr:(er=1,tr=class{constructor(t){if(!(t>0)||t-1&t)throw Error("Max size for a FixedFIFO should be a power of two");this.buffer=Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}clear(){this.top=this.btm=0,this.next=null,this.buffer.fill(void 0)}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}});return rr=class{constructor(e){this.hwm=e||16,this.head=new t(this.hwm),this.tail=this.head,this.length=0}clear(){this.head=this.tail,this.head.clear(),this.length=0}push(e){if(this.length++,!this.head.push(e)){const r=this.head;this.head=r.next=new t(2*this.head.buffer.length),this.head.push(e)}}shift(){0!==this.length&&this.length--;const t=this.tail.shift();if(void 0===t&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return t}peek(){const t=this.tail.peek();return void 0===t&&this.tail.next?this.tail.next.peek():t}isEmpty(){return 0===this.length}}}function fr(){return sr?ir:(sr=1,ir=class{constructor(t){this.decoder=new TextDecoder("utf16le"===t?"utf16-le":t)}get remaining(){return-1}decode(t){return this.decoder.decode(t,{stream:!0})}flush(){return this.decoder.decode(new Uint8Array(0))}})}function pr(){if(ar)return or;ar=1;const t=fr(),e=fr();return or=class{constructor(r="utf8"){switch(this.encoding=function(t){switch(t=t.toLowerCase()){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:throw Error("Unknown encoding: "+t)}}(r),this.encoding){case"utf8":this.decoder=new e;break;case"utf16le":case"base64":throw Error("Unsupported encoding: "+this.encoding);default:this.decoder=new t(this.encoding)}}get remaining(){return this.decoder.remaining}push(t){return"string"==typeof t?t:this.decoder.decode(t)}write(t){return this.push(t)}end(t){let e="";return t&&(e=this.push(t)),e+=this.decoder.flush(),e}}}var gr,mr,yr=function(){if(lr)return hr;lr=1;const{EventEmitter:t}=dr(),e=Error("Stream was destroyed"),r=Error("Premature close"),n=ur(),i=pr(),s=536870911,o=1^s,a=2^s,h=32,l=64,c=128,d=256,u=1024,f=2048,p=4096,g=8192,m=16384,y=32768,_=131072,b=131328,w=16^s,S=536805375,v=768^s,E=536838143,x=536739839,C=1<<18,T=2<<18,A=4<<18,k=8<<18,R=16<<18,N=32<<18,B=64<<18,I=128<<18,O=256<<18,L=512<<18,P=1024<<18,F=535822335,D=503316479,q=268435455,U=262160,M=536608751,H=8404992,j=14,z=15,W=8405006,V=33587200,K=33587215,Z=2359296,Y=270794767,$=Symbol.asyncIterator||Symbol();class G{constructor(t,{highWaterMark:e=16384,map:r=null,mapWritable:i,byteLength:s,byteLengthWritable:o}={}){this.stream=t,this.queue=new n,this.highWaterMark=e,this.buffered=0,this.error=null,this.pipeline=null,this.drains=null,this.byteLength=o||s||wt,this.map=i||r,this.afterWrite=nt.bind(this),this.afterUpdateNextTick=ot.bind(this)}get ended(){return!!(this.stream._duplexState&N)}push(t){return!(142606350&this.stream._duplexState)&&(null!==this.map&&(t=this.map(t)),this.buffered+=this.byteLength(t),this.queue.push(t),this.buffered<this.highWaterMark?(this.stream._duplexState|=k,!0):(this.stream._duplexState|=6291456,!1))}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=534773759),t}end(t){"function"==typeof t?this.stream.once("finish",t):null!=t&&this.push(t),this.stream._duplexState=(this.stream._duplexState|L)&F}autoBatch(t,e){const r=[],n=this.stream;for(r.push(t);(n._duplexState&Y)===Z;)r.push(n._writableState.shift());if(n._duplexState&z)return e(null);n._writev(r,e)}update(){const t=this.stream;t._duplexState|=T;do{for(;(t._duplexState&Y)===k;){const e=this.shift();t._duplexState|=67371008,t._write(e,this.afterWrite)}1310720&t._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());t._duplexState&=536346623}updateNonPrimary(){const t=this.stream;if((144965647&t._duplexState)===L)return t._duplexState=t._duplexState|C,void t._final(et.bind(this));4!=(t._duplexState&j)?1==(t._duplexState&K)&&(t._duplexState=(t._duplexState|U)&o,t._open(at.bind(this))):t._duplexState&V||(t._duplexState|=U,t._destroy(rt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&I)&&(this.stream._duplexState&=D,!0)}updateCallback(){(35127311&this.stream._duplexState)===A?this.update():this.updateNextTick()}updateNextTick(){this.stream._duplexState&I||(this.stream._duplexState|=I,this.stream._duplexState&T||queueMicrotask(this.afterUpdateNextTick))}}class J{constructor(t,{highWaterMark:e=16384,map:r=null,mapReadable:i,byteLength:s,byteLengthReadable:o}={}){this.stream=t,this.queue=new n,this.highWaterMark=0===e?1:e,this.buffered=0,this.readAhead=e>0,this.error=null,this.pipeline=null,this.byteLength=o||s||wt,this.map=i||r,this.pipeTo=null,this.afterRead=it.bind(this),this.afterUpdateNextTick=st.bind(this)}get ended(){return!!(this.stream._duplexState&m)}pipe(t,e){if(null!==this.pipeTo)throw Error("Can only pipe to one destination");if("function"!=typeof e&&(e=null),this.stream._duplexState|=512,this.pipeTo=t,this.pipeline=new Q(this.stream,t,e),e&&this.stream.on("error",St),bt(t))t._writableState.pipeline=this.pipeline,e&&t.on("error",St),t.on("finish",this.pipeline.finished.bind(this.pipeline));else{const e=this.pipeline.done.bind(this.pipeline,t),r=this.pipeline.done.bind(this.pipeline,t,null);t.on("error",e),t.on("close",r),t.on("finish",this.pipeline.finished.bind(this.pipeline))}t.on("drain",tt.bind(this)),this.stream.emit("piping",t),t.emit("pipe",this.stream)}push(t){const e=this.stream;return null===t?(this.highWaterMark=0,e._duplexState=536805311&e._duplexState|1024,!1):null!==this.map&&null===(t=this.map(t))?(e._duplexState&=S,this.buffered<this.highWaterMark):(this.buffered+=this.byteLength(t),this.queue.push(t),e._duplexState=(e._duplexState|c)&S,this.buffered<this.highWaterMark)}shift(){const t=this.queue.shift();return this.buffered-=this.byteLength(t),0===this.buffered&&(this.stream._duplexState&=536862591),t}unshift(t){const e=[null!==this.map?this.map(t):t];for(;this.buffered>0;)e.push(this.shift());for(let t=0;t<e.length-1;t++){const r=e[t];this.buffered+=this.byteLength(r),this.queue.push(r)}this.push(e[e.length-1])}read(){const t=this.stream;if((16527&t._duplexState)===c){const e=this.shift();return null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=v),t._duplexState&f&&t.emit("data",e),e}return!1===this.readAhead&&(t._duplexState|=_,this.updateNextTick()),null}drain(){const t=this.stream;for(;(16527&t._duplexState)===c&&768&t._duplexState;){const e=this.shift();null!==this.pipeTo&&!1===this.pipeTo.write(e)&&(t._duplexState&=v),t._duplexState&f&&t.emit("data",e)}}update(){const t=this.stream;t._duplexState|=h;do{for(this.drain();this.buffered<this.highWaterMark&&(214047&t._duplexState)===_;)t._duplexState|=65552,t._read(this.afterRead),this.drain();4224==(12431&t._duplexState)&&(t._duplexState|=g,t.emit("readable")),80&t._duplexState||this.updateNonPrimary()}while(!0===this.continueUpdate());t._duplexState&=536870879}updateNonPrimary(){const t=this.stream;(1167&t._duplexState)===u&&(t._duplexState=536869887&t._duplexState|16384,t.emit("end"),(t._duplexState&W)===H&&(t._duplexState|=4),null!==this.pipeTo&&this.pipeTo.end()),4!=(t._duplexState&j)?1==(t._duplexState&K)&&(t._duplexState=(t._duplexState|U)&o,t._open(at.bind(this))):t._duplexState&V||(t._duplexState|=U,t._destroy(rt.bind(this)))}continueUpdate(){return!!(this.stream._duplexState&y)&&(this.stream._duplexState&=E,!0)}updateCallback(){(32879&this.stream._duplexState)===l?this.update():this.updateNextTick()}updateNextTickIfOpen(){32769&this.stream._duplexState||(this.stream._duplexState|=y,this.stream._duplexState&h||queueMicrotask(this.afterUpdateNextTick))}updateNextTick(){this.stream._duplexState&y||(this.stream._duplexState|=y,this.stream._duplexState&h||queueMicrotask(this.afterUpdateNextTick))}}class X{constructor(t){this.data=null,this.afterTransform=ht.bind(t),this.afterFinal=null}}class Q{constructor(t,e,r){this.from=t,this.to=e,this.afterPipe=r,this.error=null,this.pipeToFinished=!1}finished(){this.pipeToFinished=!0}done(t,e){e&&(this.error=e),t!==this.to||(this.to=null,null===this.from)?t!==this.from||(this.from=null,null===this.to)?(null!==this.afterPipe&&this.afterPipe(this.error),this.to=this.from=this.afterPipe=null):t._duplexState&m||this.to.destroy(this.error||Error("Readable stream closed before ending")):this.from._duplexState&m&&this.pipeToFinished||this.from.destroy(this.error||Error("Writable stream closed prematurely"))}}function tt(){this.stream._duplexState|=512,this.updateCallback()}function et(t){const e=this.stream;t&&e.destroy(t),e._duplexState&j||(e._duplexState|=N,e.emit("finish")),(e._duplexState&W)===H&&(e._duplexState|=4),e._duplexState&=402391039,e._duplexState&T?this.updateNextTick():this.update()}function rt(t){const r=this.stream;t||this.error===e||(t=this.error),t&&r.emit("error",t),r._duplexState|=8,r.emit("close");const n=r._readableState,i=r._writableState;if(null!==n&&null!==n.pipeline&&n.pipeline.done(r,t),null!==i){for(;null!==i.drains&&i.drains.length>0;)i.drains.shift().resolve(!1);null!==i.pipeline&&i.pipeline.done(r,t)}}function nt(t){const e=this.stream;t&&e.destroy(t),e._duplexState&=469499903,null!==this.drains&&function(t){for(let e=0;e<t.length;e++)0==--t[e].writes&&(t.shift().resolve(!0),e--)}(this.drains),(6553615&e._duplexState)===R&&(e._duplexState&=532676607,(e._duplexState&B)===B&&e.emit("drain")),this.updateCallback()}function it(t){t&&this.stream.destroy(t),this.stream._duplexState&=w,!1!==this.readAhead||this.stream._duplexState&d||(this.stream._duplexState&=x),this.updateCallback()}function st(){this.stream._duplexState&h||(this.stream._duplexState&=E,this.update())}function ot(){this.stream._duplexState&T||(this.stream._duplexState&=D,this.update())}function at(t){const e=this.stream;t&&e.destroy(t),4&e._duplexState||(17423&e._duplexState||(e._duplexState|=l),142606351&e._duplexState||(e._duplexState|=A),e.emit("open")),e._duplexState&=M,null!==e._writableState&&e._writableState.updateCallback(),null!==e._readableState&&e._readableState.updateCallback()}function ht(t,e){null!=e&&this.push(e),this._writableState.afterWrite(t)}function lt(t){null!==this._readableState&&("data"===t&&(this._duplexState|=133376,this._readableState.updateNextTick()),"readable"===t&&(this._duplexState|=p,this._readableState.updateNextTick())),null!==this._writableState&&"drain"===t&&(this._duplexState|=B,this._writableState.updateNextTick())}class ct extends t{constructor(t){super(),this._duplexState=0,this._readableState=null,this._writableState=null,t&&(t.open&&(this._open=t.open),t.destroy&&(this._destroy=t.destroy),t.predestroy&&(this._predestroy=t.predestroy),t.signal&&t.signal.addEventListener("abort",vt.bind(this))),this.on("newListener",lt)}_open(t){t(null)}_destroy(t){t(null)}_predestroy(){}get readable(){return null!==this._readableState||void 0}get writable(){return null!==this._writableState||void 0}get destroyed(){return!!(8&this._duplexState)}get destroying(){return!!(this._duplexState&j)}destroy(t){this._duplexState&j||(t||(t=e),this._duplexState=535822271&this._duplexState|4,null!==this._readableState&&(this._readableState.highWaterMark=0,this._readableState.error=t),null!==this._writableState&&(this._writableState.highWaterMark=0,this._writableState.error=t),this._duplexState|=2,this._predestroy(),this._duplexState&=a,null!==this._readableState&&this._readableState.updateNextTick(),null!==this._writableState&&this._writableState.updateNextTick())}}class dt extends ct{constructor(t){super(t),this._duplexState|=8519681,this._readableState=new J(this,t),t&&(!1===this._readableState.readAhead&&(this._duplexState&=x),t.read&&(this._read=t.read),t.eagerOpen&&this._readableState.updateNextTick(),t.encoding&&this.setEncoding(t.encoding))}setEncoding(t){const e=new i(t),r=this._readableState.map||yt;return this._readableState.map=function(t){const n=e.push(t);return""===n&&(0!==t.byteLength||e.remaining>0)?null:r(n)},this}_read(t){t(null)}pipe(t,e){return this._readableState.updateNextTick(),this._readableState.pipe(t,e),t}read(){return this._readableState.updateNextTick(),this._readableState.read()}push(t){return this._readableState.updateNextTickIfOpen(),this._readableState.push(t)}unshift(t){return this._readableState.updateNextTickIfOpen(),this._readableState.unshift(t)}resume(){return this._duplexState|=b,this._readableState.updateNextTick(),this}pause(){return this._duplexState&=!1===this._readableState.readAhead?536739583:536870655,this}static _fromAsyncIterator(t,e){let r;const n=new dt({...e,read(e){t.next().then(i).then(e.bind(null,null)).catch(e)},predestroy(){r=t.return()},destroy(t){if(!r)return t(null);r.then(t.bind(null,null)).catch(t)}});return n;function i(t){t.done?n.push(null):n.push(t.value)}}static from(t,e){if(bt(r=t)&&r.readable)return t;var r;if(t[$])return this._fromAsyncIterator(t[$](),e);Array.isArray(t)||(t=void 0===t?[]:[t]);let n=0;return new dt({...e,read(e){this.push(n===t.length?null:t[n++]),e(null)}})}static isBackpressured(t){return!!(17422&t._duplexState)||t._readableState.buffered>=t._readableState.highWaterMark}static isPaused(t){return!(t._duplexState&d)}[$](){const t=this;let r=null,n=null,i=null;return this.on("error",(t=>{r=t})),this.on("readable",(function(){null!==n&&s(t.read())})),this.on("close",(function(){null!==n&&s(null)})),{[$](){return this},next:()=>new Promise(((e,r)=>{n=e,i=r;const o=t.read();null!==o?s(o):8&t._duplexState&&s(null)})),return:()=>o(null),throw:t=>o(t)};function s(s){null!==i&&(r?i(r):null!==s||t._duplexState&m?n({value:s,done:null===s}):i(e),i=n=null)}function o(e){return t.destroy(e),new Promise(((r,n)=>{if(8&t._duplexState)return r({value:void 0,done:!0});t.once("close",(()=>{e?n(e):r({value:void 0,done:!0})}))}))}}}class ut extends ct{constructor(t){super(t),this._duplexState|=16385,this._writableState=new G(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final),t.eagerOpen&&this._writableState.updateNextTick())}cork(){this._duplexState|=P}uncork(){this._duplexState&=q,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}static isBackpressured(t){return!!(146800654&t._duplexState)}static drained(t){if(t.destroyed)return Promise.resolve(!1);const e=t._writableState;var r;const n=((r=t)._writev!==ut.prototype._writev&&r._writev!==ft.prototype._writev?Math.min(1,e.queue.length):e.queue.length)+(t._duplexState&O?1:0);return 0===n?Promise.resolve(!0):(null===e.drains&&(e.drains=[]),new Promise((t=>{e.drains.push({writes:n,resolve:t})})))}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class ft extends dt{constructor(t){super(t),this._duplexState=1|this._duplexState&_,this._writableState=new G(this,t),t&&(t.writev&&(this._writev=t.writev),t.write&&(this._write=t.write),t.final&&(this._final=t.final))}cork(){this._duplexState|=P}uncork(){this._duplexState&=q,this._writableState.updateNextTick()}_writev(t,e){e(null)}_write(t,e){this._writableState.autoBatch(t,e)}_final(t){t(null)}write(t){return this._writableState.updateNextTick(),this._writableState.push(t)}end(t){return this._writableState.updateNextTick(),this._writableState.end(t),this}}class pt extends ft{constructor(t){super(t),this._transformState=new X(this),t&&(t.transform&&(this._transform=t.transform),t.flush&&(this._flush=t.flush))}_write(t,e){this._readableState.buffered>=this._readableState.highWaterMark?this._transformState.data=t:this._transform(t,this._transformState.afterTransform)}_read(t){if(null!==this._transformState.data){const e=this._transformState.data;this._transformState.data=null,t(null),this._transform(e,this._transformState.afterTransform)}else t(null)}destroy(t){super.destroy(t),null!==this._transformState.data&&(this._transformState.data=null,this._transformState.afterTransform())}_transform(t,e){e(null,t)}_flush(t){t(null)}_final(t){this._transformState.afterFinal=t,this._flush(gt.bind(this))}}function gt(t,e){const r=this._transformState.afterFinal;if(t)return r(t);null!=e&&this.push(e),this.push(null),r(null)}function mt(t,...e){const n=Array.isArray(t)?[...t,...e]:[t,...e],i=n.length&&"function"==typeof n[n.length-1]?n.pop():null;if(n.length<2)throw Error("Pipeline requires at least 2 streams");let s=n[0],o=null,a=null;for(let t=1;t<n.length;t++)o=n[t],bt(s)?s.pipe(o,l):(h(s,!0,t>1,l),s.pipe(o)),s=o;if(i){let t=!1;const e=bt(o)||!(!o._writableState||!o._writableState.autoDestroy);o.on("error",(t=>{null===a&&(a=t)})),o.on("finish",(()=>{t=!0,e||i(a)})),e&&o.on("close",(()=>i(a||(t?null:r))))}return o;function h(t,e,n,i){t.on("error",i),t.on("close",(function(){if(t._readableState&&!t._readableState.ended)return i(r);if(n&&t._writableState&&!t._writableState.ended)return i(r)}))}function l(t){if(t&&!a){a=t;for(const e of n)e.destroy(t)}}}function yt(t){return t}function _t(t){return!!t._readableState||!!t._writableState}function bt(t){return"number"==typeof t._duplexState&&_t(t)}function wt(t){return function(t){return"object"==typeof t&&null!==t&&"number"==typeof t.byteLength}(t)?t.byteLength:1024}function St(){}function vt(){this.destroy(Error("Stream aborted."))}return hr={pipeline:mt,pipelinePromise(...t){return new Promise(((e,r)=>mt(...t,(t=>{if(t)return r(t);e()}))))},isStream:_t,isStreamx:bt,isEnded(t){return!!t._readableState&&t._readableState.ended},isFinished(t){return!!t._writableState&&t._writableState.ended},isDisturbed(t){return!!(1&~t._duplexState)||!!(t._duplexState&V)},getStreamError(t,r={}){const n=t._readableState&&t._readableState.error||t._writableState&&t._writableState.error;return r.all||n!==e?n:null},Stream:ct,Writable:ut,Readable:dt,Duplex:ft,Transform:pt,PassThrough:class extends pt{}}}();var _r=Ue(function(){if(mr)return gr;function t(t,e){for(const r in e)Object.defineProperty(t,r,{value:e[r],enumerable:!0,configurable:!0});return t}return mr=1,gr=function(e,r,n){if(!e||"string"==typeof e)throw new TypeError("Please pass an Error to err-code");n||(n={}),"object"==typeof r&&(n=r,r=""),r&&(n.code=r);try{return t(e,n)}catch(r){n.message=e.message,n.stack=e.stack;const i=()=>{};i.prototype=Object.create(Object.getPrototypeOf(e));return t(new i,n)}}}());const br="0123456789abcdef",wr=[];for(let t=0;t<256;t++)wr[t]=br[t>>4&15]+br[15&t];const Sr=t=>{const e=t.length;let r="",n=0;for(;n<e;)r+=wr[t[n++]];return r};for(var vr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Er="undefined"==typeof Uint8Array?[]:new Uint8Array(256),xr=0;xr<64;xr++)Er[vr.charCodeAt(xr)]=xr;new TextDecoder;const Cr=new TextEncoder,Tr="undefined"!=typeof window?window:self,Ar=Tr.crypto||Tr.msCrypto||{};Ar.subtle||Ar.webkitSubtle;const kr=t=>{const e=new Uint8Array(t);return Ar.getRandomValues(e)},Rr=Ye("simple-peer"),Nr=65536;function Br(t){return t.replace(/a=ice-options:trickle\s\n/g,"")}let Ir=class t extends yr.Duplex{_pc;constructor(e){if(super(e=Object.assign({allowHalfOpen:!1},e)),this.__objectMode=!!e.objectMode,this._id=Sr(kr(4)).slice(0,7),this._debug("new peer %o",e),this.channelName=e.initiator?e.channelName||Sr(kr(20)):null,this.initiator=e.initiator||!1,this.channelConfig=e.channelConfig||t.channelConfig,this.channelNegotiated=this.channelConfig.negotiated,this.config=Object.assign({},t.config,e.config),this.offerOptions=e.offerOptions||{},this.answerOptions=e.answerOptions||{},this.sdpTransform=e.sdpTransform||(t=>t),this.trickle=void 0===e.trickle||e.trickle,this.allowHalfTrickle=void 0!==e.allowHalfTrickle&&e.allowHalfTrickle,this.iceCompleteTimeout=e.iceCompleteTimeout||5e3,this._destroying=!1,this._connected=!1,this.remoteAddress=void 0,this.remoteFamily=void 0,this.remotePort=void 0,this.localAddress=void 0,this.localFamily=void 0,this.localPort=void 0,!Ge)throw"undefined"==typeof window?_r(Error("No WebRTC support: Specify `opts.wrtc` option in this environment"),"ERR_WEBRTC_SUPPORT"):_r(Error("No WebRTC support: Not a supported browser"),"ERR_WEBRTC_SUPPORT");this._pcReady=!1,this._channelReady=!1,this._iceComplete=!1,this._iceCompleteTimer=null,this._channel=null,this._pendingCandidates=[],this._isNegotiating=!1,this._firstNegotiation=!0,this._batchedNegotiation=!1,this._queuedNegotiation=!1,this._sendersAwaitingStable=[],this._closingInterval=null,this._remoteTracks=[],this._remoteStreams=[],this._chunk=null,this._cb=null,this._interval=null;try{this._pc=new Ge(this.config)}catch(t){return void this.__destroy(_r(t,"ERR_PC_CONSTRUCTOR"))}this._isReactNativeWebrtc="number"==typeof this._pc._peerConnectionId,this._pc.oniceconnectionstatechange=()=>{this._onIceStateChange()},this._pc.onicegatheringstatechange=()=>{this._onIceStateChange()},this._pc.onconnectionstatechange=()=>{this._onConnectionStateChange()},this._pc.onsignalingstatechange=()=>{this._onSignalingStateChange()},this._pc.onicecandidate=t=>{this._onIceCandidate(t)},"object"==typeof this._pc.peerIdentity&&this._pc.peerIdentity.catch((t=>{this.__destroy(_r(t,"ERR_PC_PEER_IDENTITY"))})),this.initiator||this.channelNegotiated?this._setupData({channel:this._pc.createDataChannel(this.channelName,this.channelConfig)}):this._pc.ondatachannel=t=>{this._setupData(t)},this._debug("initial negotiation"),this._needsNegotiation(),this._onFinishBound=()=>{this._onFinish()},this.once("finish",this._onFinishBound)}get bufferSize(){return this._channel&&this._channel.bufferedAmount||0}get connected(){return this._connected&&"open"===this._channel.readyState}address(){return{port:this.localPort,family:this.localFamily,address:this.localAddress}}signal(t){if(!this._destroying){if(this.destroyed)throw _r(Error("cannot signal after peer is destroyed"),"ERR_DESTROYED");if("string"==typeof t)try{t=JSON.parse(t)}catch(e){t={}}this._debug("signal()"),t.renegotiate&&this.initiator&&(this._debug("got request to renegotiate"),this._needsNegotiation()),t.transceiverRequest&&this.initiator&&(this._debug("got request for transceiver"),this.addTransceiver(t.transceiverRequest.kind,t.transceiverRequest.init)),t.candidate&&(this._pc.remoteDescription&&this._pc.remoteDescription.type?this._addIceCandidate(t.candidate):this._pendingCandidates.push(t.candidate)),t.sdp&&this._pc.setRemoteDescription(new Je(t)).then((()=>{this.destroyed||(this._pendingCandidates.forEach((t=>{this._addIceCandidate(t)})),this._pendingCandidates=[],"offer"===this._pc.remoteDescription.type&&this._createAnswer())})).catch((t=>{this.__destroy(_r(t,"ERR_SET_REMOTE_DESCRIPTION"))})),t.sdp||t.candidate||t.renegotiate||t.transceiverRequest||this.__destroy(_r(Error("signal() called with invalid signal data"),"ERR_SIGNALING"))}}_addIceCandidate(t){const e=new Xe(t);this._pc.addIceCandidate(e).catch((t=>{!e.address||e.address.endsWith(".local")?console.warn("Ignoring unsupported ICE candidate."):this.__destroy(_r(t,"ERR_ADD_ICE_CANDIDATE"))}))}send(t){if(!this._destroying){if(this.destroyed)throw _r(Error("cannot send after peer is destroyed"),"ERR_DESTROYED");this._channel.send(t)}}_needsNegotiation(){this._debug("_needsNegotiation"),this._batchedNegotiation||(this._batchedNegotiation=!0,queueMicrotask((()=>{this._batchedNegotiation=!1,this.initiator||!this._firstNegotiation?(this._debug("starting batched negotiation"),this.negotiate()):this._debug("non-initiator initial negotiation request discarded"),this._firstNegotiation=!1})))}negotiate(){if(!this._destroying){if(this.destroyed)throw _r(Error("cannot negotiate after peer is destroyed"),"ERR_DESTROYED");this.initiator?this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("start negotiation"),setTimeout((()=>{this._createOffer()}),0)):this._isNegotiating?(this._queuedNegotiation=!0,this._debug("already negotiating, queueing")):(this._debug("requesting negotiation from initiator"),this.emit("signal",{type:"renegotiate",renegotiate:!0})),this._isNegotiating=!0}}_final(t){this._readableState.ended||this.push(null),t(null)}__destroy(t){this.end(),this._destroy((()=>{}),t)}_destroy(t,e){this.destroyed||this._destroying||(this._destroying=!0,this._debug("destroying (error: %s)",e&&(e.message||e)),setTimeout((()=>{if(this._connected=!1,this._pcReady=!1,this._channelReady=!1,this._remoteTracks=null,this._remoteStreams=null,this._senderMap=null,clearInterval(this._closingInterval),this._closingInterval=null,clearInterval(this._interval),this._interval=null,this._chunk=null,this._cb=null,this._onFinishBound&&this.removeListener("finish",this._onFinishBound),this._onFinishBound=null,this._channel){try{this._channel.close()}catch(t){}this._channel.onmessage=null,this._channel.onopen=null,this._channel.onclose=null,this._channel.onerror=null}if(this._pc){try{this._pc.close()}catch(t){}this._pc.oniceconnectionstatechange=null,this._pc.onicegatheringstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.ontrack=null,this._pc.ondatachannel=null}this._pc=null,this._channel=null,e&&this.emit("error",e),t()}),0))}_setupData(t){if(!t.channel)return this.__destroy(_r(Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL"));this._channel=t.channel,this._channel.binaryType="arraybuffer","number"==typeof this._channel.bufferedAmountLowThreshold&&(this._channel.bufferedAmountLowThreshold=Nr),this.channelName=this._channel.label,this._channel.onmessage=t=>{this._onChannelMessage(t)},this._channel.onbufferedamountlow=()=>{this._onChannelBufferedAmountLow()},this._channel.onopen=()=>{this._onChannelOpen()},this._channel.onclose=()=>{this._onChannelClose()},this._channel.onerror=t=>{const e=t.error instanceof Error?t.error:Error(`Datachannel error: ${t.message} ${t.filename}:${t.lineno}:${t.colno}`);this.__destroy(_r(e,"ERR_DATA_CHANNEL"))};let e=!1;this._closingInterval=setInterval((()=>{this._channel&&"closing"===this._channel.readyState?(e&&this._onChannelClose(),e=!0):e=!1}),5e3)}_write(t,e){if(this.destroyed)return e(_r(Error("cannot write after peer is destroyed"),"ERR_DATA_CHANNEL"));if(this._connected){try{this.send(t)}catch(t){return this.__destroy(_r(t,"ERR_DATA_CHANNEL"))}this._channel.bufferedAmount>Nr?(this._debug("start backpressure: bufferedAmount %d",this._channel.bufferedAmount),this._cb=e):e(null)}else this._debug("write before connect"),this._chunk=t,this._cb=e}_onFinish(){if(this.destroyed)return;const t=()=>{setTimeout((()=>this.__destroy()),1e3)};this._connected?t():this.once("connect",t)}_startIceCompleteTimeout(){this.destroyed||this._iceCompleteTimer||(this._debug("started iceComplete timeout"),this._iceCompleteTimer=setTimeout((()=>{this._iceComplete||(this._iceComplete=!0,this._debug("iceComplete timeout completed"),this.emit("iceTimeout"),this.emit("_iceComplete"))}),this.iceCompleteTimeout))}_createOffer(){this.destroyed||this._pc.createOffer(this.offerOptions).then((t=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(t.sdp=Br(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;const e=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:e.type,sdp:e.sdp})};this._pc.setLocalDescription(t).then((()=>{this._debug("createOffer success"),this.destroyed||(this.trickle||this._iceComplete?e():this.once("_iceComplete",e))})).catch((t=>{this.__destroy(_r(t,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((t=>{this.__destroy(_r(t,"ERR_CREATE_OFFER"))}))}_createAnswer(){this.destroyed||this._pc.createAnswer(this.answerOptions).then((t=>{if(this.destroyed)return;this.trickle||this.allowHalfTrickle||(t.sdp=Br(t.sdp)),t.sdp=this.sdpTransform(t.sdp);const e=()=>{if(this.destroyed)return;const e=this._pc.localDescription||t;this._debug("signal"),this.emit("signal",{type:e.type,sdp:e.sdp}),this.initiator||this._requestMissingTransceivers?.()};this._pc.setLocalDescription(t).then((()=>{this.destroyed||(this.trickle||this._iceComplete?e():this.once("_iceComplete",e))})).catch((t=>{this.__destroy(_r(t,"ERR_SET_LOCAL_DESCRIPTION"))}))})).catch((t=>{this.__destroy(_r(t,"ERR_CREATE_ANSWER"))}))}_onConnectionStateChange(){this.destroyed||this._destroying||"failed"===this._pc.connectionState&&this.__destroy(_r(Error("Connection failed."),"ERR_CONNECTION_FAILURE"))}_onIceStateChange(){if(this.destroyed)return;const t=this._pc.iceConnectionState,e=this._pc.iceGatheringState;this._debug("iceStateChange (connection: %s) (gathering: %s)",t,e),this.emit("iceStateChange",t,e),"connected"!==t&&"completed"!==t||(this._pcReady=!0,this._maybeReady()),"failed"===t&&this.__destroy(_r(Error("Ice connection failed."),"ERR_ICE_CONNECTION_FAILURE")),"closed"===t&&this.__destroy(_r(Error("Ice connection closed."),"ERR_ICE_CONNECTION_CLOSED"))}getStats(t){const e=t=>("[object Array]"==={}.toString.call(t.values)&&t.values.forEach((e=>{Object.assign(t,e)})),t);0===this._pc.getStats.length||this._isReactNativeWebrtc?this._pc.getStats().then((r=>{const n=[];r.forEach((t=>{n.push(e(t))})),t(null,n)}),(e=>t(e))):this._pc.getStats.length>0?this._pc.getStats((r=>{if(this.destroyed)return;const n=[];r.result().forEach((t=>{const r={};t.names().forEach((e=>{r[e]=t.stat(e)})),r.id=t.id,r.type=t.type,r.timestamp=t.timestamp,n.push(e(r))})),t(null,n)}),(e=>t(e))):t(null,[])}_maybeReady(){if(this._debug("maybeReady pc %s channel %s",this._pcReady,this._channelReady),this._connected||this._connecting||!this._pcReady||!this._channelReady)return;this._connecting=!0;const t=()=>{this.destroyed||this._destroying||this.getStats(((e,r)=>{if(this.destroyed||this._destroying)return;e&&(r=[]);const n={},i={},s={};let o=!1;r.forEach((t=>{"remotecandidate"!==t.type&&"remote-candidate"!==t.type||(n[t.id]=t),"localcandidate"!==t.type&&"local-candidate"!==t.type||(i[t.id]=t),"candidatepair"!==t.type&&"candidate-pair"!==t.type||(s[t.id]=t)}));const a=t=>{o=!0;let e=i[t.localCandidateId];e&&(e.ip||e.address)?(this.localAddress=e.ip||e.address,this.localPort=Number(e.port)):e&&e.ipAddress?(this.localAddress=e.ipAddress,this.localPort=Number(e.portNumber)):"string"==typeof t.googLocalAddress&&(e=t.googLocalAddress.split(":"),this.localAddress=e[0],this.localPort=Number(e[1])),this.localAddress&&(this.localFamily=this.localAddress.includes(":")?"IPv6":"IPv4");let r=n[t.remoteCandidateId];r&&(r.ip||r.address)?(this.remoteAddress=r.ip||r.address,this.remotePort=Number(r.port)):r&&r.ipAddress?(this.remoteAddress=r.ipAddress,this.remotePort=Number(r.portNumber)):"string"==typeof t.googRemoteAddress&&(r=t.googRemoteAddress.split(":"),this.remoteAddress=r[0],this.remotePort=Number(r[1])),this.remoteAddress&&(this.remoteFamily=this.remoteAddress.includes(":")?"IPv6":"IPv4"),this._debug("connect local: %s:%s remote: %s:%s",this.localAddress,this.localPort,this.remoteAddress,this.remotePort)};if(r.forEach((t=>{"transport"===t.type&&t.selectedCandidatePairId&&a(s[t.selectedCandidatePairId]),("googCandidatePair"===t.type&&"true"===t.googActiveConnection||("candidatepair"===t.type||"candidate-pair"===t.type)&&t.selected)&&a(t)})),o||Object.keys(s).length&&!Object.keys(i).length){if(this._connecting=!1,this._connected=!0,this._chunk){try{this.send(this._chunk)}catch(e){return this.__destroy(_r(e,"ERR_DATA_CHANNEL"))}this._chunk=null,this._debug('sent chunk from "write before connect"');const t=this._cb;this._cb=null,t(null)}"number"!=typeof this._channel.bufferedAmountLowThreshold&&(this._interval=setInterval((()=>this._onInterval()),150),this._interval.unref&&this._interval.unref()),this._debug("connect"),this.emit("connect")}else setTimeout(t,100)}))};t()}_onInterval(){!this._cb||!this._channel||this._channel.bufferedAmount>Nr||this._onChannelBufferedAmountLow()}_onSignalingStateChange(){this.destroyed||("stable"===this._pc.signalingState&&(this._isNegotiating=!1,this._debug("flushing sender queue",this._sendersAwaitingStable),this._sendersAwaitingStable.forEach((t=>{this._pc.removeTrack(t),this._queuedNegotiation=!0})),this._sendersAwaitingStable=[],this._queuedNegotiation?(this._debug("flushing negotiation queue"),this._queuedNegotiation=!1,this._needsNegotiation()):(this._debug("negotiated"),this.emit("negotiated"))),this._debug("signalingStateChange %s",this._pc.signalingState),this.emit("signalingStateChange",this._pc.signalingState))}_onIceCandidate(t){this.destroyed||(t.candidate&&this.trickle?this.emit("signal",{type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}}):t.candidate||this._iceComplete||(this._iceComplete=!0,this.emit("_iceComplete")),t.candidate&&this._startIceCompleteTimeout())}_onChannelMessage(t){if(this.destroyed)return;let e=t.data;var r;e instanceof ArrayBuffer?e=new Uint8Array(e):!1===this.__objectMode&&(r=e,e=Cr.encode(r)),this.push(e)}_onChannelBufferedAmountLow(){if(this.destroyed||!this._cb)return;this._debug("ending backpressure: bufferedAmount %d",this._channel.bufferedAmount);const t=this._cb;this._cb=null,t(null)}_onChannelOpen(){this._connected||this.destroyed||(this._debug("on channel open"),this._channelReady=!0,this._maybeReady())}_onChannelClose(){this.destroyed||(this._debug("on channel close"),this.__destroy())}_debug(){const t=[].slice.call(arguments);t[0]="["+this._id+"] "+t[0],Rr.apply(null,t)}};Ir.WEBRTC_SUPPORT=!!Ge,Ir.config={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}],sdpSemantics:"unified-plan"},Ir.channelConfig={};class Or extends Ir{constructor(t={}){super(t),this._pc&&(this.streams=t.streams||(t.stream?[t.stream]:[]),this._senderMap=new Map,this.streams&&this.streams.forEach((t=>{this.addStream(t)})),this._pc.ontrack=t=>{this._onTrack(t)})}addTransceiver(t,e){if(!this._destroying){if(this.destroyed)throw _r(Error("cannot addTransceiver after peer is destroyed"),"ERR_DESTROYED");if(this._debug("addTransceiver()"),this.initiator)try{this._pc.addTransceiver(t,e),this._needsNegotiation()}catch(t){this.__destroy(_r(t,"ERR_ADD_TRANSCEIVER"))}else this.emit("signal",{type:"transceiverRequest",transceiverRequest:{kind:t,init:e}})}}addStream(t){if(!this._destroying){if(this.destroyed)throw _r(Error("cannot addStream after peer is destroyed"),"ERR_DESTROYED");this._debug("addStream()"),t.getTracks().forEach((e=>{this.addTrack(e,t)}))}}addTrack(t,e){if(this._destroying)return;if(this.destroyed)throw _r(Error("cannot addTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("addTrack()");const r=this._senderMap.get(t)||new Map;let n=r.get(e);if(n)throw n.removed?_r(Error("Track has been removed. You should enable/disable tracks that you want to re-add."),"ERR_SENDER_REMOVED"):_r(Error("Track has already been added to that stream."),"ERR_SENDER_ALREADY_ADDED");n=this._pc.addTrack(t,e),r.set(e,n),this._senderMap.set(t,r),this._needsNegotiation()}replaceTrack(t,e,r){if(this._destroying)return;if(this.destroyed)throw _r(Error("cannot replaceTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("replaceTrack()");const n=this._senderMap.get(t),i=n?n.get(r):null;if(!i)throw _r(Error("Cannot replace track that was never added."),"ERR_TRACK_NOT_ADDED");e&&this._senderMap.set(e,n),null!=i.replaceTrack?i.replaceTrack(e):this.__destroy(_r(Error("replaceTrack is not supported in this browser"),"ERR_UNSUPPORTED_REPLACETRACK"))}removeTrack(t,e){if(this._destroying)return;if(this.destroyed)throw _r(Error("cannot removeTrack after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSender()");const r=this._senderMap.get(t),n=r?r.get(e):null;if(!n)throw _r(Error("Cannot remove track that was never added."),"ERR_TRACK_NOT_ADDED");try{n.removed=!0,this._pc.removeTrack(n)}catch(t){"NS_ERROR_UNEXPECTED"===t.name?this._sendersAwaitingStable.push(n):this.__destroy(_r(t,"ERR_REMOVE_TRACK"))}this._needsNegotiation()}removeStream(t){if(!this._destroying){if(this.destroyed)throw _r(Error("cannot removeStream after peer is destroyed"),"ERR_DESTROYED");this._debug("removeSenders()"),t.getTracks().forEach((e=>{this.removeTrack(e,t)}))}}_requestMissingTransceivers(){this._pc.getTransceivers&&this._pc.getTransceivers().forEach((t=>{t.mid||!t.sender.track||t.requested||(t.requested=!0,this.addTransceiver(t.sender.track.kind))}))}_onTrack(t){this.destroyed||t.streams.forEach((e=>{this._debug("on track"),this.emit("track",t.track,e),this._remoteTracks.push({track:t.track,stream:e}),this._remoteStreams.some((t=>t.id===e.id))||(this._remoteStreams.push(e),queueMicrotask((()=>{this._debug("on stream"),this.emit("stream",e)})))}))}}const Lr="data",Pr="signal";var Fr=(t,e)=>{const r=new Or({iceServers:[{urls:Dr}],...e,initiator:t,trickle:!1}),n=t=>i.push(t);let i=[];return r.on(Lr,n),{id:r._id,created:Date.now(),connection:r._pc,get channel(){return r._channel},get isDead(){return r.destroyed},signal(e){return new Promise((n=>{t||r.on(Pr,n),r.signal(e)}))},sendData(t){return r.send(t)},destroy(){return r.destroy()},setHandlers(t){return Object.entries(t).forEach((([t,e])=>r.on(t,e)))},offerPromise:t?new Promise((t=>r.on(Pr,t))):Promise.resolve(),addStream(t){return r.addStream(t)},removeStream(t){return r.removeStream(t)},addTrack(t,e){return r.addTrack(t,e)},removeTrack(t,e){return r.removeTrack(t,e)},replaceTrack(t,e,n){return r.replaceTrack(t,e,n)},drainEarlyData(t){r.off(Lr,n),i.forEach(t),i=null}}};const Dr=[...ue(5,((t,e)=>`stun:stun${e||""}.l.google.com:19302`)),"stun:global.stun.twilio.com:3478"],qr=Object.getPrototypeOf(Uint8Array),Ur=16369,Mr=255,Hr="bufferedamountlow",jr=t=>"@_"+t;const zr={},Wr="EVENT",Vr=ye&&ae.utils.randomPrivateKey(),Kr=ye&&Ae(ae.getPublicKey(Vr)),Zr={},Yr={},$r={},Gr=()=>Math.floor(Date.now()/1e3),Jr=t=>$r[t]??($r[t]=Ie(t,1e4)+2e4),Xr=async(t,e)=>{const r={kind:Jr(t),content:e,pubkey:Kr,created_at:Gr(),tags:[["x",t]]},n=Ae(new Uint8Array(await crypto.subtle.digest("SHA-256",Ce(Ne([0,r.pubkey,r.created_at,r.kind,r.tags,r.content])))));return Ne([Wr,{...r,id:n,sig:Ae(await ae.sign(n,Vr))}])},Qr=(t,e)=>(Zr[t]=e,Ne(["REQ",t,{kinds:[Jr(e)],since:Gr(),"#x":[e]}])),tn=t=>(delete Zr[t],Ne(["CLOSE",t])),en=(({init:t,subscribe:e,announce:r})=>{const n={};let i,s,o,a=!1;return(h,l,c)=>{const{appId:d}=h;if(n[d]?.[l])return n[d][l];const u={},f={},p=ke(de,d,l),g=Fe(p),m=Fe(ke(p,ge)),y=(async(t,e,r)=>crypto.subtle.importKey("raw",await crypto.subtle.digest({name:"SHA-256"},Ce(`${t}:${e}:${r}`)),{name:Le},!1,["encrypt","decrypt"]))(h.password||"",d,l),_=t=>async e=>({type:e.type,sdp:await t(y,e.sdp)}),b=_(qe),w=_(De),S=()=>Fr(!0,h.rtcConfig),v=(t,e,r)=>{f[e]?f[e]!==t&&t.destroy():(f[e]=t,N(t,e),u[e]?.forEach(((t,e)=>{e!==r&&t.destroy()})),delete u[e])},E=(t,e)=>{f[e]===t&&delete f[e]},x=t=>(s.push(...ue(t,S)),me(s.splice(0,t).map((t=>t.offerPromise.then(w).then((e=>({peer:t,offer:e}))))))),C=(t,e)=>c?.({error:`incorrect password (${h.password}) when decrypting ${e}`,appId:d,peerId:t,roomId:l}),T=t=>async(e,r,n)=>{const[i,s]=await me([g,m]);if(e!==i&&e!==s)return;const{peerId:o,offer:a,answer:l,peer:c}="string"==typeof r?Be(r):r;if(o!==ge&&!f[o])if(!o||a||l){if(a){const e=u[o]?.[t];if(e&&ge>o)return;const r=Fr(!1,h.rtcConfig);let i;r.setHandlers({connect(){return v(r,o,t)},close(){return E(r,o)}});try{i=await b(a)}catch{return void C(o,"offer")}if(r.isDead)return;const[s,l]=await me([Fe(ke(p,o)),r.signal(i)]);n(s,Ne({peerId:ge,answer:await w(l)}))}else if(l){let e;try{e=await b(l)}catch(t){return void C(o,"answer")}if(c)c.setHandlers({connect(){return v(c,o,t)},close(){return E(c,o)}}),c.signal(e);else{const r=u[o]?.[t];r&&!r.isDead&&r.signal(e)}}}else{if(u[o]?.[t])return;const[[{peer:e,offer:r}],i]=await me([x(1),Fe(ke(p,o))]);u[o]||=[],u[o][t]=e,setTimeout((()=>((t,e)=>{if(f[t])return;const r=u[t]?.[e];r&&(delete u[t][e],r.destroy())})(o,t)),.9*A[t]),e.setHandlers({connect(){return v(e,o,t)},close(){return E(e,o)}}),n(i,Ne({peerId:ge,offer:r}))}};if(!h)throw ve("requires a config map as the first argument");if(!d&&!h.firebaseApp)throw ve("config map is missing appId field");if(!l)throw ve("roomId argument required");if(!a){const e=t(h);s=ue(20,S),i=Array.isArray(e)?e:[e],a=!0,o=setInterval((()=>s=s.filter((t=>{const e=Date.now()-t.created<57333;return e||t.destroy(),e}))),59052.99)}const A=i.map((()=>5333)),k=[],R=i.map((async(t,r)=>e(await t,await g,await m,T(r),x)));me([g,m]).then((([t,e])=>{const n=async(i,s)=>{const o=await r(i,t,e);"number"==typeof o&&(A[s]=o),k[s]=setTimeout((()=>n(i,s)),A[s])};R.forEach((async(t,e)=>{await t,n(await i[e],e)}))}));let N=Se;return n[d]||={},n[d][l]=((t,e,r)=>{const n={},i={},s={},o={},a={},h={},l={},c={onPeerJoin:Se,onPeerLeave:Se,onPeerStream:Se,onPeerTrack:Se},d=(t,e)=>(t?Array.isArray(t)?t:[t]:we(n)).flatMap((t=>{const r=n[t];return r?e(t,r):(console.warn(`${de}: no peer with id ${t} found`),[])})),u=t=>{n[t]&&(delete n[t],delete o[t],delete a[t],c.onPeerLeave(t),e(t))},f=t=>{if(i[t])return s[t];if(!t)throw ve("action type argument is required");const e=Ce(t);if(e.byteLength>12)throw ve(`action type string "${t}" (${e.byteLength}b) exceeds byte limit (12). Hint: choose a shorter name.`);const r=new Uint8Array(12);r.set(e);let o=0;return i[t]={onComplete:Se,onProgress:Se,setOnComplete:e=>i[t]={...i[t],onComplete:e},setOnProgress:e=>i[t]={...i[t],onProgress:e},async send(t,e,i,s){if(i&&"object"!=typeof i)throw ve("action meta argument must be an object");const a=typeof t;if("undefined"===a)throw ve("action data cannot be undefined");const h="string"!==a,l=t instanceof Blob,c=l||t instanceof ArrayBuffer||t instanceof qr;if(i&&!c)throw ve("action meta argument can only be used with binary data");const u=c?new Uint8Array(l?await t.arrayBuffer():t):Ce(h?Ne(t):t),f=i?Ce(Ne(i)):null,p=Math.ceil(u.byteLength/Ur)+(i?1:0)||1,g=ue(p,((t,e)=>{const n=e===p-1,s=i&&0===e,a=new Uint8Array(15+(s?f.byteLength:n?u.byteLength-Ur*(p-(i?2:1)):Ur));return a.set(r),a.set([o],12),a.set([n|s<<1|c<<2|h<<3],13),a.set([Math.round((e+1)/p*Mr)],14),a.set(i?s?f:u.subarray((e-1)*Ur,e*Ur):u.subarray(e*Ur,(e+1)*Ur),15),a}));return o=o+1&Mr,me(d(e,(async(t,e)=>{const{channel:r}=e;let o=0;for(;o<p;){const a=g[o];if(r.bufferedAmount>r.bufferedAmountLowThreshold&&await new Promise((t=>{const e=()=>{r.removeEventListener(Hr,e),t()};r.addEventListener(Hr,e)})),!n[t])break;e.sendData(a),o++,s?.(a[14]/Mr,t,i)}})))}},s[t]||=[i[t].send,i[t].setOnComplete,i[t].setOnProgress]},p=(t,e)=>{const r=new Uint8Array(e),n=Te(r.subarray(0,12)).replaceAll("\0",""),[s]=r.subarray(12,13),[a]=r.subarray(13,14),[h]=r.subarray(14,15),l=r.subarray(15),c=!!(1&a),d=!!(2&a),u=!!(4&a),f=!!(8&a);if(!i[n])return void console.warn(`${de}: received message with unregistered type (${n})`);o[t]||={},o[t][n]||={};const p=o[t][n][s]||={chunks:[]};if(d?p.meta=Be(Te(l)):p.chunks.push(l),i[n].onProgress(h/Mr,t,p.meta),!c)return;const g=new Uint8Array(p.chunks.reduce(((t,e)=>t+e.byteLength),0));if(p.chunks.reduce(((t,e)=>(g.set(e,t),t+e.byteLength)),0),delete o[t][n][s],u)i[n].onComplete(g,t,p.meta);else{const e=Te(g);i[n].onComplete(f?Be(e):e,t)}},g=async()=>{await T(""),await new Promise((t=>setTimeout(t,99))),_e(n).forEach((([t,e])=>{e.destroy(),delete n[t]})),r()},[m,y]=f(jr("ping")),[_,b]=f(jr("pong")),[w,S]=f(jr("signal")),[v,E]=f(jr("stream")),[x,C]=f(jr("track")),[T,A]=f(jr("leave"));return t(((t,e)=>{n[e]||(n[e]=t,t.setHandlers({data:t=>p(e,t),stream(t){c.onPeerStream(t,e,h[e]),delete h[e]},track(t,r){c.onPeerTrack(t,r,e,l[e]),delete l[e]},signal:t=>w(t,e),close:()=>u(e),error:()=>u(e)}),c.onPeerJoin(e),t.drainEarlyData?.((t=>p(e,t))))})),y(((t,e)=>_("",e))),b(((t,e)=>{a[e]?.(),delete a[e]})),S(((t,e)=>n[e]?.signal(t))),E(((t,e)=>h[e]=t)),C(((t,e)=>l[e]=t)),A(((t,e)=>u(e))),ye&&addEventListener("beforeunload",g),{makeAction:f,leave:g,async ping(t){if(!t)throw ve("ping() must be called with target peer ID");const e=Date.now();return m("",t),await new Promise((e=>a[t]=e)),Date.now()-e},getPeers:()=>be(_e(n).map((([t,e])=>[t,e.connection]))),addStream:(t,e,r)=>d(e,(async(e,n)=>{r&&await v(r,e),n.addStream(t)})),removeStream:(t,e)=>d(e,((e,r)=>r.removeStream(t))),addTrack:(t,e,r,n)=>d(r,(async(r,i)=>{n&&await x(n,r),i.addTrack(t,e)})),removeTrack:(t,e,r)=>d(r,((r,n)=>n.removeTrack(t,e))),replaceTrack:(t,e,r,n,i)=>d(n,(async(n,s)=>{i&&await x(i,n),s.replaceTrack(t,e,r)})),onPeerJoin:t=>c.onPeerJoin=t,onPeerLeave:t=>c.onPeerLeave=t,onPeerStream:t=>c.onPeerStream=t,onPeerTrack:t=>c.onPeerTrack=t}})((t=>N=t),(t=>delete f[t]),(()=>{delete n[d][l],k.forEach(clearTimeout),R.forEach((async t=>(await t)())),clearInterval(o)}))}})({init(t){return Re(t,sn,5).map((t=>{const e=((t,e)=>{const r={},n=()=>{const i=new WebSocket(t);i.onclose=()=>{Oe[t]??=3333,setTimeout(n,Oe[t]),Oe[t]*=2},i.onmessage=t=>e(t.data),r.socket=i,r.url=i.url,r.ready=new Promise((e=>i.onopen=()=>{e(r),Oe[t]=3333})),r.send=t=>{1===i.readyState&&i.send(t)}};return n(),r})(t,(t=>{const[r,n,i,s]=Be(t);if(r===Wr)Yr[n]?.(Zr[n],i.content);else{const t=`${de}: relay failure from ${e.url} - `;"NOTICE"===r?console.warn(t+n):"OK"!==r||i||console.warn(t+s)}}));return zr[t]=e,e.ready}))},subscribe(t,e,r,n){const i=pe(64),s=pe(64);return Yr[i]=Yr[s]=(e,r)=>n(e,r,(async(e,r)=>t.send(await Xr(e,r)))),t.send(Qr(i,e)),t.send(Qr(s,r)),()=>{t.send(tn(i)),t.send(tn(s)),delete Yr[i],delete Yr[s]}},async announce(t,e){return t.send(await Xr(e,Ne({peerId:ge})))}}),rn=(nn=zr,()=>be(_e(nn).map((([t,e])=>[t,e.socket]))));var nn;const sn=["eu.purplerelay.com","ftp.halifax.rwth-aachen.de/nostr","longhorn.bgp.rodeo","multiplexer.huszonegy.world","nfdb.noswhere.com","nostr-verified.wellorder.net","nostr.cool110.xyz","nostr.data.haus","nostr.grooveix.com","nostr.huszonegy.world","nostr.mom","nostr.openhoofd.nl","nostr.petrkr.net/strfry","nostr.sathoarder.com","nostr.stakey.net","nostr.vulpem.com","nostr2.sanhauf.com","nostrelay.circum.space","relay.fountain.fm","relay.nostraddress.com","relay.nostromo.social","relay.snort.social","relay.verified-nostr.com","strfry.openhoofd.nl","yabu.me/v2"].map((t=>"wss://"+t));export{sn as defaultRelayUrls,rn as getRelaySockets,en as joinRoom,ge as selfId};